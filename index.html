<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Foodelo Pilot ‚Äî Executive Command Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@300;400;500&family=Instrument+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #080c10;
    --surface: #0d1318;
    --surface2: #111920;
    --border: rgba(255,255,255,0.06);
    --border-bright: rgba(255,255,255,0.12);
    --accent: #f97316;
    --accent2: #22d3ee;
    --accent3: #a3e635;
    --accent4: #f43f5e;
    --accent5: #8b5cf6;
    --text: #e8edf2;
    --text-muted: #6b7f8f;
    --text-dim: #3a4f5e;
    --green: #22c55e;
    --red: #ef4444;
    --yellow: #eab308;
    --glow-orange: rgba(249,115,22,0.15);
    --glow-cyan: rgba(34,211,238,0.1);
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Instrument Sans', sans-serif;
    font-size: 13px;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Animated background grid */
  body::before {
    content: '';
    position: fixed; inset: 0;
    background-image:
      linear-gradient(rgba(249,115,22,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(249,115,22,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  header {
    position: sticky; top: 0; z-index: 100;
    background: rgba(8,12,16,0.92);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
    padding: 0 24px;
    display: flex; align-items: center; justify-content: space-between;
    height: 56px;
  }

  .logo {
    display: flex; align-items: center; gap: 10px;
  }
  .logo-icon {
    width: 32px; height: 32px;
    background: linear-gradient(135deg, var(--accent), #dc2626);
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px;
  }
  .logo-text {
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 16px;
    letter-spacing: -0.5px;
  }
  .logo-text span { color: var(--accent); }

  .header-center {
    display: flex; align-items: center; gap: 6px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text-muted);
  }

  .live-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: var(--green);
    box-shadow: 0 0 8px var(--green);
    animation: pulse-dot 2s infinite;
  }
  @keyframes pulse-dot {
    0%,100%{ opacity:1; transform:scale(1); }
    50%{ opacity:0.6; transform:scale(1.3); }
  }

  .header-right {
    display: flex; align-items: center; gap: 16px;
  }

  .clock {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: var(--accent2);
  }

  .month-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    padding: 3px 10px;
    border-radius: 20px;
    border: 1px solid var(--accent);
    color: var(--accent);
    background: var(--glow-orange);
  }

  /* Data source bar */
  .source-bar {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 8px 24px;
    display: flex; align-items: center; gap: 16px;
    flex-wrap: wrap;
  }
  .source-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .source-chips {
    display: flex; gap: 8px; flex-wrap: wrap;
  }
  .chip {
    display: flex; align-items: center; gap: 5px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    padding: 3px 10px;
    border-radius: 4px;
    border: 1px solid var(--border-bright);
    cursor: pointer;
    transition: all 0.2s;
    color: var(--text-muted);
    background: transparent;
  }
  .chip:hover { border-color: var(--accent2); color: var(--accent2); }
  .chip.active { border-color: var(--accent2); color: var(--accent2); background: var(--glow-cyan); }
  .chip-dot { width:5px; height:5px; border-radius:50%; }

  /* TABS NAV */
  .tabs-nav {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 0 24px;
    display: flex; gap: 4px;
    overflow-x: auto;
  }
  .tab-btn {
    padding: 12px 18px;
    font-family: 'Syne', sans-serif;
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    color: var(--text-muted);
    border: none; background: none; cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .tab-btn:hover { color: var(--text); }
  .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); }

  /* MAIN LAYOUT */
  .main {
    padding: 20px 24px;
    position: relative; z-index: 1;
    max-width: 1600px;
    margin: 0 auto;
  }

  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  /* Section headers */
  .section-title {
    font-family: 'Syne', sans-serif;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-bottom: 12px;
    margin-top: 20px;
    display: flex; align-items: center; gap: 8px;
  }
  .section-title::after {
    content: ''; flex: 1;
    height: 1px; background: var(--border);
  }

  /* KPI GRID */
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 10px;
    margin-bottom: 20px;
  }

  .kpi-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 16px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.2s, transform 0.2s;
    cursor: default;
  }
  .kpi-card:hover {
    border-color: var(--border-bright);
    transform: translateY(-1px);
  }
  .kpi-card::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0;
    height: 2px;
  }
  .kpi-card.orange::before { background: linear-gradient(90deg, var(--accent), transparent); }
  .kpi-card.cyan::before { background: linear-gradient(90deg, var(--accent2), transparent); }
  .kpi-card.green::before { background: linear-gradient(90deg, var(--green), transparent); }
  .kpi-card.red::before { background: linear-gradient(90deg, var(--red), transparent); }
  .kpi-card.purple::before { background: linear-gradient(90deg, var(--accent5), transparent); }
  .kpi-card.lime::before { background: linear-gradient(90deg, var(--accent3), transparent); }

  .kpi-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9.5px;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-bottom: 8px;
  }
  .kpi-value {
    font-family: 'Syne', sans-serif;
    font-size: 22px;
    font-weight: 800;
    line-height: 1;
    margin-bottom: 6px;
    transition: all 0.5s;
  }
  .kpi-sub {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text-muted);
    display: flex; align-items: center; gap: 4px;
  }
  .delta-up { color: var(--green); }
  .delta-down { color: var(--red); }

  .sparkline {
    position: absolute; bottom: 0; right: 0;
    width: 60px; height: 30px;
    opacity: 0.4;
  }

  /* CHARTS GRID */
  .charts-grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 10px;
    margin-bottom: 20px;
  }
  .chart-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px;
    transition: border-color 0.2s;
  }
  .chart-card:hover { border-color: var(--border-bright); }

  .col-4 { grid-column: span 4; }
  .col-6 { grid-column: span 6; }
  .col-8 { grid-column: span 8; }
  .col-12 { grid-column: span 12; }
  .col-3 { grid-column: span 3; }

  @media(max-width:1200px) {
    .col-4,.col-3 { grid-column: span 6; }
    .col-8 { grid-column: span 12; }
  }
  @media(max-width:768px) {
    .col-4,.col-6,.col-8,.col-3 { grid-column: span 12; }
  }

  .chart-title {
    font-family: 'Syne', sans-serif;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.5px;
    margin-bottom: 12px;
    display: flex; align-items: center; justify-content: space-between;
  }
  .chart-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    padding: 2px 7px;
    border-radius: 3px;
    background: var(--surface2);
    color: var(--text-muted);
  }

  canvas { width: 100% !important; }

  /* Progress bars */
  .progress-item {
    margin-bottom: 10px;
  }
  .progress-row {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 4px;
  }
  .progress-name {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text-muted);
  }
  .progress-val {
    font-family: 'Syne', monospace;
    font-size: 11px;
    font-weight: 700;
  }
  .progress-bar-bg {
    height: 4px;
    background: var(--surface2);
    border-radius: 2px;
    overflow: hidden;
  }
  .progress-bar-fill {
    height: 100%;
    border-radius: 2px;
    transition: width 1s ease;
  }

  /* Table */
  .data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 11px;
  }
  .data-table th {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-dim);
    padding: 8px 10px;
    text-align: left;
    border-bottom: 1px solid var(--border);
  }
  .data-table td {
    padding: 8px 10px;
    border-bottom: 1px solid rgba(255,255,255,0.03);
    font-family: 'JetBrains Mono', monospace;
    color: var(--text-muted);
  }
  .data-table tr:hover td { background: rgba(255,255,255,0.02); }

  .rank-badge {
    display: inline-flex; align-items: center; justify-content: center;
    width: 20px; height: 20px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 700;
    font-family: 'Syne', sans-serif;
  }

  /* Score circle */
  .score-circle {
    display: inline-flex; align-items: center; justify-content: center;
    width: 36px; height: 36px;
    border-radius: 50%;
    font-family: 'Syne', sans-serif;
    font-size: 12px;
    font-weight: 800;
    border: 2px solid;
  }

  /* Status pill */
  .pill {
    display: inline-flex; align-items: center; gap: 4px;
    padding: 2px 8px;
    border-radius: 20px;
    font-size: 9px;
    font-family: 'JetBrains Mono', monospace;
    font-weight: 500;
  }
  .pill.green { background: rgba(34,197,94,0.1); color: var(--green); border: 1px solid rgba(34,197,94,0.2); }
  .pill.red { background: rgba(239,68,68,0.1); color: var(--red); border: 1px solid rgba(239,68,68,0.2); }
  .pill.yellow { background: rgba(234,179,8,0.1); color: var(--yellow); border: 1px solid rgba(234,179,8,0.2); }
  .pill.orange { background: rgba(249,115,22,0.1); color: var(--accent); border: 1px solid rgba(249,115,22,0.2); }

  /* Month progress track */
  .pilot-track {
    display: flex; gap: 8px; margin-bottom: 20px;
  }
  .track-phase {
    flex: 1;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px 14px;
    position: relative;
    overflow: hidden;
  }
  .track-phase.active-phase {
    border-color: var(--accent);
    background: linear-gradient(135deg, rgba(249,115,22,0.08), transparent);
  }
  .track-phase-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-dim);
    margin-bottom: 4px;
  }
  .track-phase-name {
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 700;
    margin-bottom: 6px;
  }
  .track-phase-bar {
    height: 3px;
    background: var(--surface2);
    border-radius: 2px;
    overflow: hidden;
  }
  .track-phase-fill {
    height: 100%;
    border-radius: 2px;
    background: var(--accent);
    transition: width 1.5s ease;
  }

  /* Alert ticker */
  .alert-ticker {
    background: var(--surface);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent);
    border-radius: 0 6px 6px 0;
    padding: 8px 14px;
    display: flex; align-items: center; gap: 10px;
    margin-bottom: 16px;
    overflow: hidden;
  }
  .ticker-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 1px;
    white-space: nowrap;
  }
  .ticker-text {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text-muted);
    white-space: nowrap;
    animation: ticker 30s linear infinite;
  }
  @keyframes ticker {
    0% { transform: translateX(100vw); }
    100% { transform: translateX(-200%); }
  }

  /* Upload / connect zone */
  .connect-card {
    background: var(--surface);
    border: 1px dashed var(--border-bright);
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 12px;
  }
  .connect-card:hover {
    border-color: var(--accent2);
    background: var(--glow-cyan);
  }
  .connect-icon { font-size: 24px; margin-bottom: 6px; }
  .connect-title {
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 700;
    margin-bottom: 4px;
  }
  .connect-desc {
    font-size: 11px;
    color: var(--text-muted);
  }

  input[type=file] { display: none; }

  .btn {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 7px 14px;
    border-radius: 6px;
    font-family: 'Syne', sans-serif;
    font-size: 11px;
    font-weight: 700;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
  }
  .btn-primary {
    background: var(--accent);
    color: white;
  }
  .btn-primary:hover { background: #ea6a0a; }
  .btn-secondary {
    background: var(--surface2);
    color: var(--text-muted);
    border: 1px solid var(--border-bright);
  }
  .btn-secondary:hover { color: var(--text); border-color: var(--accent2); }

  .flex-row { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }

  /* Rider professionalism radar */
  .radar-labels {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 6px; margin-top: 10px;
  }
  .radar-item {
    display: flex; align-items: center; gap: 6px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px; color: var(--text-muted);
  }
  .radar-dot { width:6px; height:6px; border-radius:50%; flex-shrink:0; }

  /* Scrollbar */
  ::-webkit-scrollbar { width:4px; height:4px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--text-dim); border-radius:2px; }

  /* Tooltip */
  .tooltip-host { position: relative; }
  .tooltip-host:hover .tooltip-box { display: block; }
  .tooltip-box {
    display: none;
    position: absolute; bottom: calc(100% + 6px); left: 50%;
    transform: translateX(-50%);
    background: #1a2530;
    border: 1px solid var(--border-bright);
    border-radius: 6px;
    padding: 6px 10px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text);
    white-space: nowrap;
    z-index: 200;
  }

  .num-animate { transition: all 0.6s ease; }

  /* WebSocket status */
  .ws-status {
    display: flex; align-items: center; gap: 6px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text-muted);
  }
  .ws-dot { width:6px; height:6px; border-radius:50%; }
  .ws-dot.connected { background: var(--green); box-shadow: 0 0 6px var(--green); }
  .ws-dot.simulated { background: var(--yellow); box-shadow: 0 0 6px var(--yellow); }

  .summary-grid {
    display: grid;
    grid-template-columns: repeat(3,1fr);
    gap: 8px;
    margin-bottom: 12px;
  }
  @media(max-width:768px){
    .summary-grid { grid-template-columns:1fr; }
    .pilot-track { flex-direction:column; }
  }

  /* ‚ïê‚ïê LOGIN SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  #loginScreen {
    position: fixed; inset: 0; z-index: 9999;
    background: #080c10;
    display: flex; align-items: center; justify-content: center;
    flex-direction: column;
  }
  #loginScreen::before {
    content:'';
    position:absolute;inset:0;
    background-image:
      linear-gradient(rgba(249,115,22,0.04) 1px,transparent 1px),
      linear-gradient(90deg,rgba(249,115,22,0.04) 1px,transparent 1px);
    background-size:40px 40px;
    animation: gridDrift 20s linear infinite;
  }
  @keyframes gridDrift {
    0%{background-position:0 0}
    100%{background-position:40px 40px}
  }
  .login-box {
    position:relative; z-index:1;
    background: rgba(13,19,24,0.95);
    border: 1px solid rgba(249,115,22,0.2);
    border-radius: 16px;
    padding: 44px 48px;
    width: 100%; max-width: 420px;
    box-shadow: 0 0 80px rgba(249,115,22,0.08), 0 32px 64px rgba(0,0,0,0.6);
    animation: loginFadeIn 0.6s ease;
  }
  @keyframes loginFadeIn {
    from{opacity:0;transform:translateY(24px) scale(0.98)}
    to{opacity:1;transform:translateY(0) scale(1)}
  }
  .login-logo {
    display:flex;align-items:center;gap:12px;
    margin-bottom:32px;
  }
  .login-logo-icon {
    width:48px;height:48px;
    background:linear-gradient(135deg,#f97316,#dc2626);
    border-radius:12px;
    display:flex;align-items:center;justify-content:center;
    font-size:24px;
    box-shadow:0 8px 24px rgba(249,115,22,0.3);
  }
  .login-logo-text {
    font-family:'Syne',sans-serif;
    font-size:22px; font-weight:800;
    letter-spacing:-0.5px;
    color:#e8edf2;
  }
  .login-logo-text span{color:#f97316;}
  .login-title {
    font-family:'Syne',sans-serif;
    font-size:15px; font-weight:700;
    color:#e8edf2; margin-bottom:4px;
  }
  .login-sub {
    font-family:'JetBrains Mono',monospace;
    font-size:10px; color:#6b7f8f;
    margin-bottom:28px;
    text-transform:uppercase; letter-spacing:1px;
  }
  .login-field {
    margin-bottom:14px;
  }
  .login-field label {
    display:block;
    font-family:'JetBrains Mono',monospace;
    font-size:9px; color:#6b7f8f;
    text-transform:uppercase; letter-spacing:1px;
    margin-bottom:6px;
  }
  .login-field input {
    width:100%;
    background:#111920;
    border:1px solid rgba(255,255,255,0.08);
    border-radius:8px;
    color:#e8edf2;
    padding:11px 14px;
    font-family:'JetBrains Mono',monospace;
    font-size:13px;
    outline:none;
    transition:border-color 0.2s, box-shadow 0.2s;
  }
  .login-field input:focus {
    border-color:rgba(249,115,22,0.5);
    box-shadow:0 0 0 3px rgba(249,115,22,0.08);
  }
  .login-field input::placeholder{color:#3a4f5e;}
  .login-btn {
    width:100%;
    margin-top:8px;
    padding:12px;
    background:linear-gradient(135deg,#f97316,#dc2626);
    border:none; border-radius:8px;
    color:#fff;
    font-family:'Syne',sans-serif;
    font-size:13px; font-weight:700;
    cursor:pointer;
    transition:all 0.2s;
    box-shadow:0 4px 20px rgba(249,115,22,0.25);
    letter-spacing:0.5px;
  }
  .login-btn:hover{transform:translateY(-1px);box-shadow:0 8px 28px rgba(249,115,22,0.35);}
  .login-btn:active{transform:translateY(0);}
  .login-btn:disabled{opacity:0.6;cursor:not-allowed;transform:none;}
  .login-error {
    font-family:'JetBrains Mono',monospace;
    font-size:10px; color:#ef4444;
    text-align:center; margin-top:10px;
    min-height:16px;
    animation: errShake 0.3s ease;
  }
  @keyframes errShake {
    0%,100%{transform:translateX(0)}
    25%{transform:translateX(-6px)}
    75%{transform:translateX(6px)}
  }
  .login-divider {
    display:flex;align-items:center;gap:10px;
    margin:20px 0;
  }
  .login-divider::before,.login-divider::after {
    content:'';flex:1;height:1px;background:rgba(255,255,255,0.06);
  }
  .login-divider span {
    font-family:'JetBrains Mono',monospace;
    font-size:9px; color:#3a4f5e; text-transform:uppercase;
  }
  .login-roles {
    display:grid;grid-template-columns:1fr 1fr;gap:8px;
    margin-bottom:20px;
  }
  .role-btn {
    padding:8px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.07);
    border-radius:8px;
    cursor:pointer;
    text-align:center;
    transition:all 0.2s;
    font-family:'JetBrains Mono',monospace;
  }
  .role-btn:hover{border-color:rgba(249,115,22,0.3);background:rgba(249,115,22,0.05);}
  .role-btn.selected{border-color:rgba(249,115,22,0.5);background:rgba(249,115,22,0.08);}
  .role-btn .role-icon{font-size:18px;margin-bottom:3px;}
  .role-btn .role-name{font-size:9px;color:#6b7f8f;text-transform:uppercase;letter-spacing:0.5px;}
  .role-btn.selected .role-name{color:#f97316;}
  .login-footer {
    margin-top:20px;text-align:center;
    font-family:'JetBrains Mono',monospace;
    font-size:9px; color:#3a4f5e;
  }
  .login-footer span{color:#6b7f8f;}
  .login-screen-exit {
    animation: loginExit 0.4s ease forwards;
  }
  @keyframes loginExit {
    to{opacity:0;transform:scale(1.03);pointer-events:none;}
  }
  /* Role badge in header */
  .role-badge {
    font-family:'JetBrains Mono',monospace;
    font-size:9px;
    padding:3px 9px;
    border-radius:4px;
    background:rgba(139,92,246,0.15);
    border:1px solid rgba(139,92,246,0.3);
    color:#8b5cf6;
  }
  /* Session timer */
  .session-timer {
    font-family:'JetBrains Mono',monospace;
    font-size:9px; color:#3a4f5e;
  }

  /* ‚ïê‚ïê ADMIN PANEL OVERLAY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  #adminOverlay {
    display:none;
    position:fixed;inset:0;z-index:8000;
    background:rgba(8,12,16,0.92);
    backdrop-filter:blur(10px);
    overflow-y:auto;
    padding:20px;
  }
  .admin-panel {
    max-width:940px;margin:0 auto;
    background:var(--surface);
    border:1px solid rgba(139,92,246,0.3);
    border-radius:16px;
    overflow:hidden;
    box-shadow:0 0 80px rgba(139,92,246,0.1), 0 32px 64px rgba(0,0,0,0.5);
    animation:adminSlideIn 0.35s ease;
  }
  @keyframes adminSlideIn {
    from{opacity:0;transform:translateY(30px)}
    to{opacity:1;transform:translateY(0)}
  }
  .admin-header {
    background:linear-gradient(135deg,rgba(139,92,246,0.2),rgba(249,115,22,0.1));
    border-bottom:1px solid rgba(139,92,246,0.2);
    padding:20px 28px;
    display:flex;align-items:center;justify-content:space-between;
  }
  .admin-header-left {display:flex;align-items:center;gap:14px;}
  .admin-header-icon {
    width:44px;height:44px;
    background:linear-gradient(135deg,#8b5cf6,#6d28d9);
    border-radius:10px;
    display:flex;align-items:center;justify-content:center;
    font-size:22px;
  }
  .admin-title {
    font-family:'Syne',sans-serif;font-size:18px;font-weight:800;
    color:var(--text);
  }
  .admin-sub {
    font-family:'JetBrains Mono',monospace;font-size:9px;
    color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;
  }
  .admin-close {
    background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.2);
    color:#ef4444;font-family:'JetBrains Mono',monospace;font-size:11px;
    padding:8px 16px;border-radius:8px;cursor:pointer;transition:all 0.2s;
  }
  .admin-close:hover{background:rgba(239,68,68,0.2);}
  .admin-tabs {
    display:flex;border-bottom:1px solid var(--border);
    background:var(--surface2);overflow-x:auto;
  }
  .admin-tab {
    padding:12px 20px;font-family:'Syne',sans-serif;font-size:11px;
    font-weight:700;color:var(--text-muted);cursor:pointer;
    border-bottom:2px solid transparent;white-space:nowrap;
    transition:all 0.2s;background:none;border-top:none;border-left:none;border-right:none;
  }
  .admin-tab:hover{color:var(--text);}
  .admin-tab.active{color:var(--accent5);border-bottom-color:var(--accent5);}
  .admin-body {padding:24px 28px;}
  .admin-section {display:none;}
  .admin-section.active{display:block;}
  .admin-card {
    background:var(--surface2);border:1px solid var(--border);
    border-radius:10px;padding:18px 20px;margin-bottom:14px;
  }
  .admin-card-title {
    font-family:'Syne',sans-serif;font-size:12px;font-weight:700;
    color:var(--text);margin-bottom:14px;
    display:flex;align-items:center;gap:8px;
  }
  .admin-label {
    font-family:'JetBrains Mono',monospace;font-size:9px;
    color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;
    margin-bottom:5px;display:block;
  }
  .admin-input {
    width:100%;background:var(--surface);
    border:1px solid var(--border-bright);
    color:var(--text);padding:9px 13px;border-radius:7px;
    font-family:'JetBrains Mono',monospace;font-size:11px;outline:none;
    transition:border-color 0.2s;margin-bottom:10px;
  }
  .admin-input:focus{border-color:rgba(139,92,246,0.5);}
  .admin-input-row {display:grid;grid-template-columns:1fr 1fr;gap:12px;}
  .admin-input-row3 {display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;}
  .admin-save-btn {
    background:linear-gradient(135deg,#8b5cf6,#6d28d9);
    border:none;border-radius:8px;color:#fff;
    font-family:'Syne',sans-serif;font-size:11px;font-weight:700;
    padding:9px 20px;cursor:pointer;transition:all 0.2s;
    box-shadow:0 4px 16px rgba(139,92,246,0.25);
  }
  .admin-save-btn:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(139,92,246,0.35);}
  .admin-danger-btn {
    background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.2);
    color:#ef4444;font-family:'JetBrains Mono',monospace;font-size:10px;
    padding:7px 14px;border-radius:7px;cursor:pointer;transition:all 0.2s;
  }
  .admin-danger-btn:hover{background:rgba(239,68,68,0.2);}
  .admin-success {
    font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--green);
    margin-top:8px;display:none;
  }
  .admin-grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
  .admin-grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;}
  .user-row {
    display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:8px;
    align-items:center;margin-bottom:8px;
  }
  .status-dot-admin {
    width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:5px;
  }
  .conn-status {
    font-family:'JetBrains Mono',monospace;font-size:10px;
    padding:4px 10px;border-radius:4px;display:inline-block;
  }
  .conn-status.connected{background:rgba(34,197,94,0.1);color:var(--green);border:1px solid rgba(34,197,94,0.2);}
  .conn-status.disconnected{background:rgba(107,127,143,0.1);color:var(--text-muted);border:1px solid var(--border);}
  .conn-status.testing{background:rgba(234,179,8,0.1);color:var(--yellow);border:1px solid rgba(234,179,8,0.2);}
  .admin-toggle {
    display:flex;align-items:center;justify-content:space-between;
    padding:10px 0;border-bottom:1px solid var(--border);
  }
  .admin-toggle:last-child{border-bottom:none;}
  .toggle-label {font-family:'Instrument Sans',sans-serif;font-size:12px;color:var(--text);}
  .toggle-sub {font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text-muted);margin-top:2px;}
  .toggle-switch {
    position:relative;width:40px;height:22px;flex-shrink:0;
  }
  .toggle-switch input{opacity:0;width:0;height:0;}
  .toggle-slider {
    position:absolute;inset:0;background:var(--surface2);
    border:1px solid var(--border-bright);border-radius:22px;cursor:pointer;
    transition:all 0.3s;
  }
  .toggle-slider:before {
    content:'';position:absolute;
    width:16px;height:16px;left:2px;top:2px;
    background:var(--text-muted);border-radius:50%;transition:all 0.3s;
  }
  .toggle-switch input:checked + .toggle-slider{background:rgba(139,92,246,0.3);border-color:var(--accent5);}
  .toggle-switch input:checked + .toggle-slider:before{transform:translateX(18px);background:var(--accent5);}
  select.admin-input{cursor:pointer;}
  @media(max-width:700px){
    .admin-input-row,.admin-input-row3,.admin-grid2,.admin-grid3{grid-template-columns:1fr;}
    .user-row{grid-template-columns:1fr 1fr;gap:6px;}
    .admin-body{padding:16px;}
  }
</style>
</head>
<body>

<!-- ‚ïê‚ïê LOGIN SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="loginScreen">
  <div class="login-box">
    <div class="login-logo">
      <div class="login-logo-icon">üçú</div>
      <div>
        <div class="login-logo-text">Foodelo <span>Pilot</span></div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#3a4f5e;letter-spacing:1px;text-transform:uppercase;">Executive Command Dashboard</div>
      </div>
    </div>

    <div class="login-title">Restricted Access</div>
    <div class="login-sub">Authorized Personnel Only ¬∑ 3-Month Pilot Program</div>

    <div style="margin-bottom:16px;">
      <div class="kpi-label" style="margin-bottom:8px;font-size:9px;">Select your role</div>
      <div class="login-roles">
        <div class="role-btn selected" onclick="selectRole(this,'Executive')" data-role="Executive">
          <div class="role-icon">üëî</div>
          <div class="role-name">Executive</div>
        </div>
        <div class="role-btn" onclick="selectRole(this,'Operations')" data-role="Operations">
          <div class="role-icon">‚öôÔ∏è</div>
          <div class="role-name">Operations</div>
        </div>
        <div class="role-btn" onclick="selectRole(this,'Finance')" data-role="Finance">
          <div class="role-icon">üí∞</div>
          <div class="role-name">Finance</div>
        </div>
        <div class="role-btn" onclick="selectRole(this,'Viewer')" data-role="Viewer">
          <div class="role-icon">üëÅÔ∏è</div>
          <div class="role-name">Viewer</div>
        </div>
      </div>
    </div>

    <div class="login-field">
      <label>Username</label>
      <input type="text" id="loginUser" placeholder="Enter your username" autocomplete="username"
             onkeydown="if(event.key==='Enter')document.getElementById('loginPass').focus()">
    </div>
    <div class="login-field">
      <label>Password</label>
      <div style="position:relative;">
        <input type="password" id="loginPass" placeholder="Enter your password" autocomplete="current-password"
               onkeydown="if(event.key==='Enter')attemptLogin()"
               style="padding-right:40px;">
        <span onclick="togglePwd()" style="position:absolute;right:12px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:14px;color:#3a4f5e;user-select:none;" id="pwdEye">üëÅ</span>
      </div>
    </div>

    <div id="loginError" class="login-error"></div>

    <button class="login-btn" id="loginBtn" onclick="attemptLogin()">
      Access Dashboard ‚Üí
    </button>

    <div class="login-divider"><span>Pilot Access Credentials</span></div>

    <div style="background:rgba(249,115,22,0.05);border:1px solid rgba(249,115,22,0.12);border-radius:8px;padding:10px 14px;">
      <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#6b7f8f;line-height:2;">
        <span style="color:#f97316;">Executive</span> ¬∑ user: <b style="color:#e8edf2;">admin</b> ¬∑ pass: <b style="color:#e8edf2;">Foodelo@2025</b><br>
        <span style="color:#22d3ee;">Operations</span> ¬∑ user: <b style="color:#e8edf2;">ops</b> ¬∑ pass: <b style="color:#e8edf2;">Pilot@Ops</b><br>
        <span style="color:#22c55e;">Finance</span> ¬∑ user: <b style="color:#e8edf2;">finance</b> ¬∑ pass: <b style="color:#e8edf2;">Fin@2025</b><br>
        <span style="color:#8b5cf6;">Viewer</span> ¬∑ user: <b style="color:#e8edf2;">viewer</b> ¬∑ pass: <b style="color:#e8edf2;">View@Pilot</b>
      </div>
    </div>

    <div class="login-footer">
      Secured ¬∑ <span>Foodelo Pilot Program 2025</span> ¬∑ Powered by FundCo
    </div>
  </div>
</div>


<!-- HEADER -->
<header>
  <div class="logo">
    <div class="logo-icon">üçú</div>
    <div class="logo-text">Foodelo <span>Pilot</span></div>
  </div>
  <div class="header-center">
    <div class="live-dot"></div>
    <span>LIVE COMMAND DASHBOARD</span>
    <span style="color:var(--text-dim)">¬∑</span>
    <span id="headerDate"></span>
  </div>
  <div class="header-right">
    <div class="ws-status">
      <div class="ws-dot simulated" id="wsDot"></div>
      <span id="wsLabel">Simulated Feed</span>
    </div>
    <div class="clock" id="clock"></div>
    <span class="role-badge" id="roleBadge">‚Äî</span>
    <div class="session-timer" id="sessionTimer"></div>
    <div class="month-badge" id="currentPhaseBadge">MONTH 1 ‚Äî BASELINE</div>
    <button onclick="logOut()" style="background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.2);color:#ef4444;font-family:'JetBrains Mono',monospace;font-size:9px;padding:4px 10px;border-radius:4px;cursor:pointer;">‚èª Logout</button>
  </div>
</header>

<!-- SOURCE BAR -->
<div class="source-bar">
  <span class="source-label">Data Sources:</span>
  <div class="source-chips">
    <div class="chip active" onclick="toggleChip(this,'foodelo-api')">
      <div class="chip-dot" style="background:var(--green)"></div>
      Foodelo API
    </div>
    <div class="chip" onclick="triggerFileUpload('excel')" id="chip-excel">
      <div class="chip-dot" style="background:var(--accent)"></div>
      Excel / CSV Upload
    </div>
    <div class="chip" onclick="toggleChip(this,'sharepoint')" id="chip-sp">
      <div class="chip-dot" style="background:var(--accent2)"></div>
      SharePoint
    </div>
    <div class="chip" onclick="triggerFileUpload('json')" id="chip-json">
      <div class="chip-dot" style="background:var(--accent5)"></div>
      JSON Feed
    </div>
    <div class="chip" onclick="connectWebSocket()" id="chip-ws">
      <div class="chip-dot" style="background:var(--yellow)"></div>
      WebSocket (Live)
    </div>
  </div>
  <input type="file" id="fileInput" accept=".csv,.xlsx,.json" onchange="handleFileUpload(event)">
  <div style="margin-left:auto;" class="flex-row">
    <button class="btn btn-secondary" onclick="exportData()">‚¨á Export</button>
    <button class="btn btn-primary" onclick="refreshAll()">‚Üª Refresh</button>
  </div>
</div>

<!-- ALERT TICKER -->
<div class="alert-ticker">
  <span class="ticker-label">‚ö° Live Feed</span>
  <div class="ticker-text" id="alertTicker">
    Order #1042 Completed ‚Äî Jollof Rice ‚Äî ‚Ç¶2,400 ¬∑ Rider EMK-07 delivered in 18 min ¬∑ New merchant onboarded: Mama Titi Kitchen ¬∑ Platform uptime: 99.7% ¬∑ 3 new customer reviews ¬∑ Payment success rate: 97.2% ¬∑ Daily orders target 85% achieved ¬∑ Top meal today: Pounded Yam Egusi
  </div>
</div>

<!-- TABS -->
<div class="tabs-nav">
  <button class="tab-btn active" onclick="switchTab('overview')">üìä Overview</button>
  <button class="tab-btn" onclick="switchTab('financial')">üí∞ Financial</button>
  <button class="tab-btn" onclick="switchTab('customers')">üë• Customers</button>
  <button class="tab-btn" onclick="switchTab('merchants')">üè™ Merchants</button>
  <button class="tab-btn" onclick="switchTab('tech')">‚öôÔ∏è Technology</button>
  <button class="tab-btn" onclick="switchTab('riders')">üõµ Riders</button>
  <button class="tab-btn" onclick="switchTab('scalability')">üìà Scalability</button>
  <button class="tab-btn" onclick="switchTab('connect')">üîó Connect Data</button>
  <button class="tab-btn" id="adminTabBtn" onclick="openAdminTab()" style="margin-left:auto;color:var(--accent5);border-bottom-color:transparent;">‚öôÔ∏è Admin Settings</button>
</div>

<!-- MAIN -->
<div class="main">

  <!-- ‚îÄ‚îÄ OVERVIEW TAB ‚îÄ‚îÄ -->
  <div class="tab-panel active" id="tab-overview">

    <!-- Pilot phase track -->
    <div class="section-title">3-Month Pilot Phase Tracker</div>
    <div class="pilot-track">
      <div class="track-phase active-phase">
        <div class="track-phase-label">Month 1</div>
        <div class="track-phase-name">üîµ Baseline</div>
        <div style="font-size:10px;color:var(--text-muted);margin-bottom:8px;">Establish metrics, onboard</div>
        <div class="track-phase-bar"><div class="track-phase-fill" style="width:68%"></div></div>
        <div style="font-size:9px;color:var(--accent);margin-top:4px;font-family:'JetBrains Mono',monospace;">68% complete</div>
      </div>
      <div class="track-phase">
        <div class="track-phase-label">Month 2</div>
        <div class="track-phase-name" style="color:var(--text-muted)">‚ö° Optimization</div>
        <div style="font-size:10px;color:var(--text-dim);margin-bottom:8px;">Improve & iterate</div>
        <div class="track-phase-bar"><div class="track-phase-fill" style="width:0%"></div></div>
        <div style="font-size:9px;color:var(--text-dim);margin-top:4px;font-family:'JetBrains Mono',monospace;">Not started</div>
      </div>
      <div class="track-phase">
        <div class="track-phase-label">Month 3</div>
        <div class="track-phase-name" style="color:var(--text-muted)">‚úÖ Validation</div>
        <div style="font-size:10px;color:var(--text-dim);margin-bottom:8px;">Scale readiness check</div>
        <div class="track-phase-bar"><div class="track-phase-fill" style="width:0%"></div></div>
        <div style="font-size:9px;color:var(--text-dim);margin-top:4px;font-family:'JetBrains Mono',monospace;">Not started</div>
      </div>
    </div>

    <!-- Top KPIs -->
    <div class="section-title">Key Performance Indicators ‚Äî Today</div>
    <div class="kpi-grid">
      <div class="kpi-card orange tooltip-host">
        <div class="kpi-label">Total Orders</div>
        <div class="kpi-value" id="kpi-orders" style="color:var(--accent)">1,284</div>
        <div class="kpi-sub"><span class="delta-up">‚ñ≤ 12.4%</span><span>vs yesterday</span></div>
        <div class="tooltip-box">Cumulative pilot orders. Target: 5,000/month</div>
      </div>
      <div class="kpi-card orange tooltip-host">
        <div class="kpi-label">Revenue</div>
        <div class="kpi-value" id="kpi-rev" style="color:var(--accent)">‚Ç¶3.08M</div>
        <div class="kpi-sub"><span class="delta-up">‚ñ≤ 8.1%</span><span>vs last week</span></div>
      </div>
      <div class="kpi-card green tooltip-host">
        <div class="kpi-label">Platform Uptime</div>
        <div class="kpi-value" id="kpi-uptime" style="color:var(--green)">99.7%</div>
        <div class="kpi-sub"><span class="delta-up">‚úì SLA met</span></div>
      </div>
      <div class="kpi-card cyan">
        <div class="kpi-label">Active Riders</div>
        <div class="kpi-value" id="kpi-riders" style="color:var(--accent2)">24</div>
        <div class="kpi-sub"><span class="delta-up">‚ñ≤ 4</span><span>new today</span></div>
      </div>
      <div class="kpi-card cyan">
        <div class="kpi-label">Avg Delivery</div>
        <div class="kpi-value" id="kpi-delivery" style="color:var(--accent2)">22<span style="font-size:13px">min</span></div>
        <div class="kpi-sub"><span class="delta-up">‚ñº 3min</span><span>improvement</span></div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-label">CSAT Score</div>
        <div class="kpi-value" id="kpi-csat" style="color:var(--green)">4.3<span style="font-size:13px">/5</span></div>
        <div class="kpi-sub"><span class="delta-up">‚ñ≤ 0.2</span><span>this week</span></div>
      </div>
      <div class="kpi-card purple">
        <div class="kpi-label">NPS</div>
        <div class="kpi-value" id="kpi-nps" style="color:var(--accent5)">62</div>
        <div class="kpi-sub"><span class="delta-up">Good</span></div>
      </div>
      <div class="kpi-card red">
        <div class="kpi-label">Refund Rate</div>
        <div class="kpi-value" id="kpi-refund" style="color:var(--red)">1.8<span style="font-size:13px">%</span></div>
        <div class="kpi-sub"><span class="delta-up">‚ñº 0.3%</span><span>improving</span></div>
      </div>
      <div class="kpi-card lime">
        <div class="kpi-label">Payment Success</div>
        <div class="kpi-value" id="kpi-payment" style="color:var(--accent3)">97.2<span style="font-size:13px">%</span></div>
        <div class="kpi-sub"><span class="delta-up">‚ñ≤ 1.1%</span></div>
      </div>
      <div class="kpi-card orange">
        <div class="kpi-label">Op Expenses</div>
        <div class="kpi-value" id="kpi-opex" style="color:var(--accent)">‚Ç¶820K</div>
        <div class="kpi-sub"><span>Rider+Support+Inc.</span></div>
      </div>
    </div>

    <!-- Charts row -->
    <div class="section-title">Performance Trends</div>
    <div class="charts-grid">
      <div class="chart-card col-8">
        <div class="chart-title">Daily Orders & Revenue ‚Äî Month 1 <span class="chart-badge">LIVE</span></div>
        <canvas id="orderRevenueChart" height="220"></canvas>
      </div>
      <div class="chart-card col-4">
        <div class="chart-title">Orders by Category</div>
        <canvas id="categoryChart" height="220"></canvas>
      </div>
    </div>

    <div class="charts-grid">
      <div class="chart-card col-4">
        <div class="chart-title">Conversion Funnel</div>
        <canvas id="funnelChart" height="180"></canvas>
      </div>
      <div class="chart-card col-4">
        <div class="chart-title">Customer Retention (Days)</div>
        <canvas id="retentionChart" height="180"></canvas>
      </div>
      <div class="chart-card col-4">
        <div class="chart-title">Hourly Order Volume</div>
        <canvas id="hourlyChart" height="180"></canvas>
      </div>
    </div>

    <!-- Top meals -->
    <div class="section-title">Top Meals from InfraCredit DREEF Pilot (50 Staff)</div>
    <div class="chart-card">
      <table class="data-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Meal</th>
            <th>Orders</th>
            <th>Revenue</th>
            <th>Avg Rating</th>
            <th>Trend</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="mealsTable"></tbody>
      </table>
    </div>

  </div><!-- /overview -->


  <!-- ‚îÄ‚îÄ FINANCIAL TAB ‚îÄ‚îÄ -->
  <div class="tab-panel" id="tab-financial">
    <div class="section-title">Financial Performance Dashboard</div>
    <div class="kpi-grid">
      <div class="kpi-card orange">
        <div class="kpi-label">Total Completed Orders</div>
        <div class="kpi-value" style="color:var(--accent)" id="fin-orders">1,284</div>
        <div class="kpi-sub"><span class="delta-up">‚ñ≤ 12%</span> MTD</div>
      </div>
      <div class="kpi-card orange">
        <div class="kpi-label">Gross Revenue</div>
        <div class="kpi-value" style="color:var(--accent)" id="fin-rev">‚Ç¶3.08M</div>
        <div class="kpi-sub">Month to date</div>
      </div>
      <div class="kpi-card red">
        <div class="kpi-label">Operational Expenses</div>
        <div class="kpi-value" style="color:var(--red)" id="fin-opex">‚Ç¶820K</div>
        <div class="kpi-sub">Riders + Support + Inc.</div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-label">Net Revenue</div>
        <div class="kpi-value" style="color:var(--green)" id="fin-net">‚Ç¶2.26M</div>
        <div class="kpi-sub"><span class="delta-up">73.4%</span> margin</div>
      </div>
      <div class="kpi-card red">
        <div class="kpi-label">Refund Rate</div>
        <div class="kpi-value" style="color:var(--red)">1.8%</div>
        <div class="kpi-sub"><span class="delta-up">‚ñº improving</span></div>
      </div>
      <div class="kpi-card lime">
        <div class="kpi-label">ROAS</div>
        <div class="kpi-value" style="color:var(--accent3)">3.75x</div>
        <div class="kpi-sub">Marketing efficiency</div>
      </div>
    </div>

    <div class="charts-grid">
      <div class="chart-card col-6">
        <div class="chart-title">Revenue vs Expenses ‚Äî Month Progression</div>
        <canvas id="finRevExpChart" height="240"></canvas>
      </div>
      <div class="chart-card col-6">
        <div class="chart-title">Cost Breakdown</div>
        <canvas id="costBreakChart" height="240"></canvas>
      </div>
    </div>

    <div class="charts-grid">
      <div class="chart-card col-12">
        <div class="chart-title">Revenue Growth Trajectory ‚Äî Month 1 ‚Üí Month 3 (Projection)</div>
        <canvas id="revenueGrowthChart" height="200"></canvas>
      </div>
    </div>
  </div>


  <!-- ‚îÄ‚îÄ CUSTOMERS TAB ‚îÄ‚îÄ -->
  <div class="tab-panel" id="tab-customers">
    <div class="section-title">Customer Engagement Analytics</div>
    <div class="kpi-grid">
      <div class="kpi-card cyan">
        <div class="kpi-label">DAU</div>
        <div class="kpi-value" style="color:var(--accent2)">428</div>
        <div class="kpi-sub"><span class="delta-up">‚ñ≤ 6.2%</span></div>
      </div>
      <div class="kpi-card cyan">
        <div class="kpi-label">WAU</div>
        <div class="kpi-value" style="color:var(--accent2)">1.8K</div>
        <div class="kpi-sub">Weekly actives</div>
      </div>
      <div class="kpi-card cyan">
        <div class="kpi-label">MAU</div>
        <div class="kpi-value" style="color:var(--accent2)">4.2K</div>
        <div class="kpi-sub">Monthly actives</div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-label">Conversion Rate</div>
        <div class="kpi-value" style="color:var(--green)">34.2%</div>
        <div class="kpi-sub">Visit ‚Üí Order</div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-label">Repeat Purchase</div>
        <div class="kpi-value" style="color:var(--green)">58.7%</div>
        <div class="kpi-sub"><span class="delta-up">‚ñ≤ 4.3%</span></div>
      </div>
      <div class="kpi-card purple">
        <div class="kpi-label">CLV (Pilot Est.)</div>
        <div class="kpi-value" style="color:var(--accent5)">‚Ç¶14.6K</div>
        <div class="kpi-sub">3-month window</div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-label">CSAT</div>
        <div class="kpi-value" style="color:var(--green)">4.3/5</div>
        <div class="kpi-sub">Customer sat. score</div>
      </div>
      <div class="kpi-card purple">
        <div class="kpi-label">NPS</div>
        <div class="kpi-value" style="color:var(--accent5)">62</div>
        <div class="kpi-sub">Net Promoter Score</div>
      </div>
      <div class="kpi-card red">
        <div class="kpi-label">Complaint Rate</div>
        <div class="kpi-value" style="color:var(--red)">2.1%</div>
        <div class="kpi-sub"><span class="delta-up">‚ñº improving</span></div>
      </div>
    </div>

    <div class="charts-grid">
      <div class="chart-card col-6">
        <div class="chart-title">Customer Retention ‚Äî 30/60/90 Day Cohorts</div>
        <canvas id="retentionCohortChart" height="250"></canvas>
      </div>
      <div class="chart-card col-6">
        <div class="chart-title">Review Score Distribution</div>
        <canvas id="reviewChart" height="250"></canvas>
      </div>
    </div>
  </div>


  <!-- ‚îÄ‚îÄ MERCHANTS TAB ‚îÄ‚îÄ -->
  <div class="tab-panel" id="tab-merchants">
    <div class="section-title">Merchant / Partner Performance</div>
    <div class="kpi-grid">
      <div class="kpi-card orange">
        <div class="kpi-label">Active Merchants</div>
        <div class="kpi-value" style="color:var(--accent)">12</div>
        <div class="kpi-sub">Pilot partners</div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-label">Acceptance Rate</div>
        <div class="kpi-value" style="color:var(--green)">91.4%</div>
        <div class="kpi-sub"><span class="delta-up">‚ñ≤ 3%</span></div>
      </div>
      <div class="kpi-card red">
        <div class="kpi-label">Rejection Rate</div>
        <div class="kpi-value" style="color:var(--red)">8.6%</div>
        <div class="kpi-sub">Monitor closely</div>
      </div>
      <div class="kpi-card cyan">
        <div class="kpi-label">Avg Orders/Merchant</div>
        <div class="kpi-value" style="color:var(--accent2)">107</div>
        <div class="kpi-sub">This month</div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-label">Merchant Sat. Score</div>
        <div class="kpi-value" style="color:var(--green)">4.1/5</div>
        <div class="kpi-sub">Survey avg.</div>
      </div>
      <div class="kpi-card red">
        <div class="kpi-label">Avg Escalations</div>
        <div class="kpi-value" style="color:var(--red)">1.3</div>
        <div class="kpi-sub">Per merchant/wk</div>
      </div>
    </div>

    <div class="section-title">Merchant Leaderboard</div>
    <div class="chart-card">
      <table class="data-table">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Merchant</th>
            <th>Orders</th>
            <th>Acceptance %</th>
            <th>Avg Prep Time</th>
            <th>Sat. Score</th>
            <th>Escalations</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="merchantTable"></tbody>
      </table>
    </div>

    <div class="charts-grid">
      <div class="chart-card col-6">
        <div class="chart-title">Orders per Merchant</div>
        <canvas id="merchantOrdersChart" height="220"></canvas>
      </div>
      <div class="chart-card col-6">
        <div class="chart-title">Delivery Timeline: Prep ‚Üí Customer (mins)</div>
        <canvas id="deliveryTimelineChart" height="220"></canvas>
      </div>
    </div>
  </div>


  <!-- ‚îÄ‚îÄ TECH TAB ‚îÄ‚îÄ -->
  <div class="tab-panel" id="tab-tech">
    <div class="section-title">Technology Performance</div>
    <div class="kpi-grid">
      <div class="kpi-card green">
        <div class="kpi-label">Platform Uptime</div>
        <div class="kpi-value" style="color:var(--green)">99.7%</div>
        <div class="kpi-sub"><span class="pill green">SLA Met</span></div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-label">Order Success Rate</div>
        <div class="kpi-value" style="color:var(--green)">98.4%</div>
        <div class="kpi-sub"><span class="delta-up">‚ñ≤ 0.6%</span></div>
      </div>
      <div class="kpi-card lime">
        <div class="kpi-label">Payment Success</div>
        <div class="kpi-value" style="color:var(--accent3)">97.2%</div>
        <div class="kpi-sub"><span class="delta-up">‚ñ≤ 1.1%</span></div>
      </div>
      <div class="kpi-card cyan">
        <div class="kpi-label">Wallet Usage Rate</div>
        <div class="kpi-value" style="color:var(--accent2)">41.3%</div>
        <div class="kpi-sub">of total payments</div>
      </div>
      <div class="kpi-card red">
        <div class="kpi-label">Failed Transactions</div>
        <div class="kpi-value" style="color:var(--red)">2.8%</div>
        <div class="kpi-sub"><span class="delta-down">Needs attention</span></div>
      </div>
      <div class="kpi-card yellow" style="--yellow-glow:rgba(234,179,8,0.1)">
        <div class="kpi-label">Bug Resolution Time</div>
        <div class="kpi-value" style="color:var(--yellow)">4.2<span style="font-size:13px">hrs</span></div>
        <div class="kpi-sub">Avg time</div>
      </div>
      <div class="kpi-card purple">
        <div class="kpi-label">Feature Adoption</div>
        <div class="kpi-value" style="color:var(--accent5)">67.8%</div>
        <div class="kpi-sub">Wallet + tracking</div>
      </div>
      <div class="kpi-card lime">
        <div class="kpi-label">Scale Readiness</div>
        <div class="kpi-value" style="color:var(--accent3)">74%</div>
        <div class="kpi-sub">Infra score</div>
      </div>
    </div>

    <div class="charts-grid">
      <div class="chart-card col-8">
        <div class="chart-title">Platform Uptime ‚Äî Hourly (Last 24h) <span class="chart-badge">LIVE</span></div>
        <canvas id="uptimeChart" height="200"></canvas>
      </div>
      <div class="chart-card col-4">
        <div class="chart-title">Payment Methods Split</div>
        <canvas id="paymentSplitChart" height="200"></canvas>
      </div>
    </div>

    <div class="charts-grid">
      <div class="chart-card col-12">
        <div class="chart-title">Tech KPIs ‚Äî Week over Week Trend</div>
        <canvas id="techTrendChart" height="180"></canvas>
      </div>
    </div>
  </div>


  <!-- ‚îÄ‚îÄ RIDERS TAB ‚îÄ‚îÄ -->
  <div class="tab-panel" id="tab-riders">
    <div class="section-title">Rider Operations & Professionalism</div>
    <div class="kpi-grid">
      <div class="kpi-card orange">
        <div class="kpi-label">Active Riders</div>
        <div class="kpi-value" style="color:var(--accent)">24</div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-label">Acceptance Rate</div>
        <div class="kpi-value" style="color:var(--green)">88.6%</div>
      </div>
      <div class="kpi-card cyan">
        <div class="kpi-label">Orders/Rider/Day</div>
        <div class="kpi-value" style="color:var(--accent2)">12.4</div>
      </div>
      <div class="kpi-card cyan">
        <div class="kpi-label">Avg Delivery Time</div>
        <div class="kpi-value" style="color:var(--accent2)">22<span style="font-size:13px">min</span></div>
      </div>
      <div class="kpi-card lime">
        <div class="kpi-label">Rider Earnings/Day</div>
        <div class="kpi-value" style="color:var(--accent3)">‚Ç¶8.4K</div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-label">Retention Rate</div>
        <div class="kpi-value" style="color:var(--green)">91.7%</div>
      </div>
      <div class="kpi-card purple">
        <div class="kpi-label">Capacity Util.</div>
        <div class="kpi-value" style="color:var(--accent5)">78.3%</div>
      </div>
      <div class="kpi-card orange">
        <div class="kpi-label">Prof. Score Index</div>
        <div class="kpi-value" style="color:var(--accent)">82/100</div>
      </div>
    </div>

    <div class="section-title">Professionalism Scorecard</div>
    <div class="charts-grid">
      <div class="chart-card col-4">
        <div class="chart-title">Professionalism Radar</div>
        <canvas id="profRadarChart" height="260"></canvas>
        <div class="radar-labels">
          <div class="radar-item"><div class="radar-dot" style="background:var(--accent)"></div>Appearance</div>
          <div class="radar-item"><div class="radar-dot" style="background:var(--accent2)"></div>Communication</div>
          <div class="radar-item"><div class="radar-dot" style="background:var(--green)"></div>Conduct</div>
          <div class="radar-item"><div class="radar-dot" style="background:var(--accent5)"></div>Reliability</div>
          <div class="radar-item"><div class="radar-dot" style="background:var(--yellow)"></div>Customer FB</div>
          <div class="radar-item"><div class="radar-dot" style="background:var(--accent3)"></div>Training</div>
        </div>
      </div>
      <div class="chart-card col-4">
        <div class="chart-title">Professionalism Breakdown</div>
        <div class="progress-item">
          <div class="progress-row"><span class="progress-name">Appearance & Uniform</span><span class="progress-val" style="color:var(--accent)">87%</span></div>
          <div class="progress-bar-bg"><div class="progress-bar-fill" style="width:87%;background:var(--accent)"></div></div>
        </div>
        <div class="progress-item">
          <div class="progress-row"><span class="progress-name">Communication & Politeness</span><span class="progress-val" style="color:var(--accent2)">83%</span></div>
          <div class="progress-bar-bg"><div class="progress-bar-fill" style="width:83%;background:var(--accent2)"></div></div>
        </div>
        <div class="progress-item">
          <div class="progress-row"><span class="progress-name">Conduct & Compliance</span><span class="progress-val" style="color:var(--green)">92%</span></div>
          <div class="progress-bar-bg"><div class="progress-bar-fill" style="width:92%;background:var(--green)"></div></div>
        </div>
        <div class="progress-item">
          <div class="progress-row"><span class="progress-name">Attendance & Punctuality</span><span class="progress-val" style="color:var(--accent5)">79%</span></div>
          <div class="progress-bar-bg"><div class="progress-bar-fill" style="width:79%;background:var(--accent5)"></div></div>
        </div>
        <div class="progress-item">
          <div class="progress-row"><span class="progress-name">Customer Feedback Rating</span><span class="progress-val" style="color:var(--yellow)">81%</span></div>
          <div class="progress-bar-bg"><div class="progress-bar-fill" style="width:81%;background:var(--yellow)"></div></div>
        </div>
        <div class="progress-item">
          <div class="progress-row"><span class="progress-name">Training Completion</span><span class="progress-val" style="color:var(--accent3)">74%</span></div>
          <div class="progress-bar-bg"><div class="progress-bar-fill" style="width:74%;background:var(--accent3)"></div></div>
        </div>
      </div>
      <div class="chart-card col-4">
        <div class="chart-title">Issue Management</div>
        <canvas id="riderIssueChart" height="220"></canvas>
      </div>
    </div>

    <div class="section-title">Rider Leaderboard</div>
    <div class="chart-card">
      <table class="data-table">
        <thead>
          <tr>
            <th>Rank</th><th>Rider ID</th><th>Orders/Day</th><th>Avg Delivery</th><th>Prof. Score</th><th>Complaints</th><th>Earnings/Day</th><th>Status</th>
          </tr>
        </thead>
        <tbody id="riderTable"></tbody>
      </table>
    </div>
  </div>


  <!-- ‚îÄ‚îÄ SCALABILITY TAB ‚îÄ‚îÄ -->
  <div class="tab-panel" id="tab-scalability">
    <div class="section-title">Scalability & Sustainability Indicators</div>
    <div class="kpi-grid">
      <div class="kpi-card green">
        <div class="kpi-label">Zone Profitability</div>
        <div class="kpi-value" style="color:var(--green)">‚Ç¶1.44M</div>
        <div class="kpi-sub">Net positive</div>
      </div>
      <div class="kpi-card orange">
        <div class="kpi-label">Min Viable Orders/Day</div>
        <div class="kpi-value" style="color:var(--accent)">68</div>
        <div class="kpi-sub">Current avg: 86</div>
      </div>
      <div class="kpi-card cyan">
        <div class="kpi-label">Rider:Order Ratio</div>
        <div class="kpi-value" style="color:var(--accent2)">1:12.4</div>
        <div class="kpi-sub">Optimal target: 1:15</div>
      </div>
      <div class="kpi-card red">
        <div class="kpi-label">Merchant Concentration</div>
        <div class="kpi-value" style="color:var(--red)">38%</div>
        <div class="kpi-sub">Top 2 merchants</div>
      </div>
      <div class="kpi-card yellow" style="">
        <div class="kpi-label">Incentive Dependency</div>
        <div class="kpi-value" style="color:var(--yellow)">22%</div>
        <div class="kpi-sub">Of total orders</div>
      </div>
      <div class="kpi-card lime">
        <div class="kpi-label">Scale Readiness</div>
        <div class="kpi-value" style="color:var(--accent3)">2.1x</div>
        <div class="kpi-sub">Capacity headroom</div>
      </div>
    </div>

    <div class="charts-grid">
      <div class="chart-card col-6">
        <div class="chart-title">Operational Efficiency ‚Äî Month 1 vs Projected Month 3</div>
        <canvas id="efficiencyChart" height="250"></canvas>
      </div>
      <div class="chart-card col-6">
        <div class="chart-title">Scale Readiness Index (5x Target)</div>
        <canvas id="scaleChart" height="250"></canvas>
      </div>
    </div>

    <div class="chart-card" style="margin-bottom:20px;">
      <div class="chart-title">Month 1 ‚Üí Month 3 Pilot Outcome Summary</div>
      <table class="data-table">
        <thead><tr><th>Metric</th><th>Month 1 (Baseline)</th><th>Month 2 (Projected)</th><th>Month 3 (Target)</th><th>Status</th></tr></thead>
        <tbody id="pilotSummaryTable"></tbody>
      </table>
    </div>
  </div>


  <!-- ‚îÄ‚îÄ CONNECT DATA TAB ‚îÄ‚îÄ -->
  <div class="tab-panel" id="tab-connect">
    <div class="section-title">Data Integration & Connection Hub</div>

    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;margin-bottom:20px;">

      <div class="connect-card" onclick="document.getElementById('fileInput').click()">
        <div class="connect-icon">üìä</div>
        <div class="connect-title">Excel / CSV Upload</div>
        <div class="connect-desc">Upload .xlsx or .csv with pilot data. Headers auto-mapped to KPIs.</div>
        <br>
        <span class="pill green">‚úì Supported</span>
      </div>

      <div class="connect-card" onclick="showSharePointConfig()">
        <div class="connect-icon">‚òÅÔ∏è</div>
        <div class="connect-title">SharePoint / OneDrive</div>
        <div class="connect-desc">Paste your SharePoint file URL. Dashboard polls every 60 seconds for updates.</div>
        <br><span class="pill yellow">Configure</span>
      </div>

      <div class="connect-card" onclick="showAPIConfig()">
        <div class="connect-icon">üçú</div>
        <div class="connect-title">Foodelo App API</div>
        <div class="connect-desc">Directly connect to Foodelo's REST API. Requires API key from your admin panel.</div>
        <br><span class="pill orange">API Key Required</span>
      </div>

      <div class="connect-card" onclick="connectWebSocket()">
        <div class="connect-icon">‚ö°</div>
        <div class="connect-title">WebSocket Live Feed</div>
        <div class="connect-desc">Real-time streaming connection. Zero-lag data updates via WSS protocol.</div>
        <br><span class="pill yellow">Connect WSS</span>
      </div>

      <div class="connect-card" onclick="showGoogleSheets()">
        <div class="connect-icon">üìã</div>
        <div class="connect-title">Google Sheets</div>
        <div class="connect-desc">Paste any Google Sheets link ‚Äî auto-converts & syncs live.</div>
        <br><span class="pill green">‚úì Supported</span>
      </div>

      <div class="connect-card">
        <div class="connect-icon">üîÑ</div>
        <div class="connect-title">JSON REST API</div>
        <div class="connect-desc">Paste any JSON endpoint. Configure polling interval (default: 30s).</div>
        <br><span class="pill green">‚úì Supported</span>
      </div>

    </div>

    <!-- Config panels -->
    <div id="apiConfigPanel" style="display:none;">
      <div class="chart-card" style="margin-bottom:12px;">
        <div class="chart-title">üçú Foodelo API Configuration</div>
        <div style="display:grid;gap:10px;margin-top:12px;">
          <div>
            <div class="kpi-label" style="margin-bottom:4px;">API Base URL</div>
            <input id="apiUrl" type="text" placeholder="https://api.foodelo.ng/v1" style="width:100%;background:var(--surface2);border:1px solid var(--border-bright);color:var(--text);padding:8px 12px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:11px;outline:none;">
          </div>
          <div>
            <div class="kpi-label" style="margin-bottom:4px;">API Key</div>
            <input id="apiKey" type="password" placeholder="flo_live_xxxxxxxxxxxx" style="width:100%;background:var(--surface2);border:1px solid var(--border-bright);color:var(--text);padding:8px 12px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:11px;outline:none;">
          </div>
          <div>
            <div class="kpi-label" style="margin-bottom:4px;">Poll Interval (seconds)</div>
            <input id="pollInterval" type="number" value="30" style="width:200px;background:var(--surface2);border:1px solid var(--border-bright);color:var(--text);padding:8px 12px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:11px;outline:none;">
          </div>
          <div class="flex-row">
            <button class="btn btn-primary" onclick="connectAPI()">Connect API</button>
            <button class="btn btn-secondary" onclick="testAPIConnection()">Test Connection</button>
          </div>
          <div id="apiStatus" style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-muted);"></div>
        </div>
      </div>
    </div>

    <div id="sharePointPanel" style="display:none;">
      <div class="chart-card" style="margin-bottom:12px;">
        <div class="chart-title">‚òÅÔ∏è SharePoint Configuration</div>
        <div style="display:grid;gap:10px;margin-top:12px;">
          <div>
            <div class="kpi-label" style="margin-bottom:4px;">SharePoint File URL</div>
            <input id="spUrl" type="text" placeholder="https://yourorg.sharepoint.com/sites/.../foodelo-pilot.xlsx" style="width:100%;background:var(--surface2);border:1px solid var(--border-bright);color:var(--text);padding:8px 12px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:11px;outline:none;">
          </div>
          <div class="flex-row">
            <button class="btn btn-primary" onclick="connectSharePoint()">Connect SharePoint</button>
          </div>
          <div class="kpi-label" style="color:var(--text-dim);">
            Note: For SharePoint, ensure the file is shared publicly or use Microsoft Graph API credentials. The dashboard polls for updates every 60 seconds.
          </div>
        </div>
      </div>
    </div>

    <!-- Google Sheets Panel -->
    <div id="googleSheetsPanel" style="display:none;margin-bottom:12px;">
      <div class="chart-card">
        <div class="chart-title">üìã Google Sheets ‚Äî Live Connection</div>
        <div style="display:grid;gap:10px;margin-top:12px;">

          <div style="background:rgba(34,211,238,0.05);border:1px solid rgba(34,211,238,0.15);border-radius:8px;padding:12px;">
            <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--accent2);font-weight:700;margin-bottom:8px;">üìå HOW TO MAKE YOUR SHEET PUBLIC (Required)</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);line-height:1.8;">
              1. Open your Google Sheet<br>
              2. Click <b style="color:var(--text)">File ‚Üí Share ‚Üí Publish to web</b><br>
              3. Select <b style="color:var(--text)">Sheet1</b> (or the sheet with your data) and <b style="color:var(--text)">Comma-separated values (.csv)</b><br>
              4. Click <b style="color:var(--text)">Publish</b> ‚Üí Copy the link<br>
              5. OR just paste the normal Google Sheets URL below ‚Äî we'll convert it automatically
            </div>
          </div>

          <div>
            <div class="kpi-label" style="margin-bottom:4px;">Google Sheets URL (any format ‚Äî edit, share, or publish link)</div>
            <input id="gsUrl" type="text"
              placeholder="https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/edit"
              style="width:100%;background:var(--surface2);border:1px solid var(--border-bright);color:var(--text);padding:8px 12px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:11px;outline:none;"
              oninput="document.getElementById('gsUrlPreview').textContent=parseGoogleSheetURL(this.value)||'(paste link above)'"
            >
            <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text-dim);margin-top:4px;">
              CSV endpoint: <span id="gsUrlPreview" style="color:var(--accent2)">(paste link above)</span>
            </div>
          </div>

          <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
            <div>
              <div class="kpi-label" style="margin-bottom:4px;">Auto-refresh every (seconds)</div>
              <input id="gsInterval" type="number" value="60" min="10"
                style="width:100px;background:var(--surface2);border:1px solid var(--border-bright);color:var(--text);padding:8px 12px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:11px;outline:none;">
            </div>
          </div>

          <div class="flex-row">
            <button id="gsConnectBtn" class="btn btn-primary" onclick="connectGoogleSheets()">Connect Google Sheets</button>
            <button class="btn btn-secondary" onclick="disconnectGoogleSheets()">Disconnect</button>
          </div>

          <div id="gsStatus" style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-muted);">Not connected</div>

          <div>
            <div class="kpi-label" style="margin-bottom:6px;">Live Data Preview (last 4 rows)</div>
            <div style="overflow-x:auto;">
              <table class="data-table" id="gsPreviewTable" style="font-size:10px;"></table>
            </div>
          </div>

          <div style="background:rgba(249,115,22,0.05);border:1px solid rgba(249,115,22,0.15);border-radius:8px;padding:12px;">
            <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--accent);font-weight:700;margin-bottom:6px;">üìä EXPECTED COLUMN NAMES IN YOUR SHEET</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);line-height:1.8;">
              Use any of these column headers (case-insensitive):<br>
              <span style="color:var(--accent2)">total_orders</span> ¬∑ <span style="color:var(--accent2)">revenue</span> ¬∑ <span style="color:var(--accent2)">opex</span> ¬∑ <span style="color:var(--accent2)">csat</span> ¬∑ <span style="color:var(--accent2)">nps</span> ¬∑ <span style="color:var(--accent2)">avg_delivery</span><br>
              <span style="color:var(--accent2)">uptime</span> ¬∑ <span style="color:var(--accent2)">payment_success</span> ¬∑ <span style="color:var(--accent2)">active_riders</span> ¬∑ <span style="color:var(--accent2)">refund_rate</span> ¬∑ <span style="color:var(--accent2)">dau</span><br>
              Also accepts: <span style="color:var(--text-dim)">orders, sales, gross_revenue, delivery_time, system_uptime, riders...</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Data mapping -->
    <div class="section-title">Column Mapping (After Upload)</div>
    <div class="chart-card">
      <table class="data-table">
        <thead>
          <tr><th>Dashboard Field</th><th>Expected Column Name</th><th>Data Type</th><th>Status</th></tr>
        </thead>
        <tbody>
          <tr><td>Total Orders</td><td>total_orders / completed_orders</td><td>INTEGER</td><td><span class="pill green">Auto-detected</span></td></tr>
          <tr><td>Revenue</td><td>revenue / gross_revenue / rev</td><td>CURRENCY (‚Ç¶)</td><td><span class="pill green">Auto-detected</span></td></tr>
          <tr><td>Operational Expenses</td><td>opex / expenses / operational_cost</td><td>CURRENCY (‚Ç¶)</td><td><span class="pill green">Auto-detected</span></td></tr>
          <tr><td>Refund Rate</td><td>refund_rate / refunds</td><td>PERCENTAGE</td><td><span class="pill green">Auto-detected</span></td></tr>
          <tr><td>DAU / WAU / MAU</td><td>dau / wau / mau / daily_users</td><td>INTEGER</td><td><span class="pill green">Auto-detected</span></td></tr>
          <tr><td>CSAT Score</td><td>csat / customer_satisfaction</td><td>FLOAT (0‚Äì5)</td><td><span class="pill green">Auto-detected</span></td></tr>
          <tr><td>NPS</td><td>nps / net_promoter</td><td>INTEGER (-100‚Äì100)</td><td><span class="pill green">Auto-detected</span></td></tr>
          <tr><td>Platform Uptime</td><td>uptime / platform_uptime</td><td>PERCENTAGE</td><td><span class="pill green">Auto-detected</span></td></tr>
          <tr><td>Rider Delivery Time</td><td>delivery_time / avg_delivery</td><td>INTEGER (minutes)</td><td><span class="pill green">Auto-detected</span></td></tr>
          <tr><td>Date Column</td><td>date / order_date / timestamp</td><td>DATE (YYYY-MM-DD)</td><td><span class="pill green">Auto-detected</span></td></tr>
        </tbody>
      </table>
    </div>

    <div id="uploadFeedback" style="margin-top:12px;"></div>
  </div>


<!-- ‚ïê‚ïê ADMIN SETTINGS OVERLAY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="adminOverlay">
  <div class="admin-panel">

    <div class="admin-header">
      <div class="admin-header-left">
        <div class="admin-header-icon">‚öôÔ∏è</div>
        <div>
          <div class="admin-title">Admin Settings</div>
          <div class="admin-sub">Foodelo Pilot Dashboard ‚Äî Configuration Center</div>
        </div>
      </div>
      <button class="admin-close" onclick="closeAdmin()">‚úï Close</button>
    </div>

    <!-- Admin sub-tabs -->
    <div class="admin-tabs">
      <button class="admin-tab active" onclick="switchAdminTab('datasources')">üîó Data Sources</button>
      <button class="admin-tab" onclick="switchAdminTab('users')">üë• Users & Access</button>
      <button class="admin-tab" onclick="switchAdminTab('pilot')">üìä Pilot Settings</button>
      <button class="admin-tab" onclick="switchAdminTab('kpitargets')">üéØ KPI Targets</button>
      <button class="admin-tab" onclick="switchAdminTab('display')">üñ•Ô∏è Display</button>
      <button class="admin-tab" onclick="switchAdminTab('notifications')">üîî Alerts</button>
    </div>

    <div class="admin-body">

      <!-- ‚îÄ‚îÄ DATA SOURCES ‚îÄ‚îÄ -->
      <div class="admin-section active" id="asec-datasources">

        <!-- Google Sheets -->
        <div class="admin-card">
          <div class="admin-card-title">üìã Google Sheets
            <span class="conn-status disconnected" id="gs-admin-status">Disconnected</span>
          </div>
          <div class="admin-input-row">
            <div>
              <label class="admin-label">Google Sheets URL (any format)</label>
              <input class="admin-input" id="adm-gsUrl" placeholder="https://docs.google.com/spreadsheets/d/..." type="text">
            </div>
            <div>
              <label class="admin-label">Auto-refresh Interval (seconds)</label>
              <input class="admin-input" id="adm-gsInterval" type="number" value="60" min="10">
            </div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
            <button class="admin-save-btn" onclick="admConnectGS()">‚ö° Connect & Sync Now</button>
            <button class="admin-danger-btn" onclick="admDisconnectGS()">Disconnect</button>
          </div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text-dim);margin-top:10px;">
            üí° Make sheet public: File ‚Üí Share ‚Üí Publish to web ‚Üí CSV ‚Üí Publish
          </div>
          <div class="admin-success" id="gs-admin-msg">‚úì Connected successfully</div>
        </div>

        <!-- Foodelo App API -->
        <div class="admin-card">
          <div class="admin-card-title">üçú Foodelo App API
            <span class="conn-status disconnected" id="api-admin-status">Disconnected</span>
          </div>
          <div class="admin-input-row">
            <div>
              <label class="admin-label">API Base URL</label>
              <input class="admin-input" id="adm-apiUrl" placeholder="https://api.foodelo.ng/v1" type="text">
            </div>
            <div>
              <label class="admin-label">API Key</label>
              <input class="admin-input" id="adm-apiKey" placeholder="flo_live_xxxxxxxxxxxx" type="password">
            </div>
          </div>
          <div class="admin-input-row">
            <div>
              <label class="admin-label">Poll Interval (seconds)</label>
              <input class="admin-input" id="adm-apiInterval" type="number" value="30" min="10">
            </div>
            <div>
              <label class="admin-label">Endpoint Path (optional)</label>
              <input class="admin-input" id="adm-apiEndpoint" placeholder="/pilot/metrics" type="text">
            </div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button class="admin-save-btn" onclick="admConnectAPI()">‚ö° Connect API</button>
            <button class="admin-danger-btn" onclick="admTestAPI()">üî¨ Test Connection</button>
            <button class="admin-danger-btn" onclick="admDisconnectAPI()">Disconnect</button>
          </div>
          <div class="admin-success" id="api-admin-msg">‚úì API connected</div>
          <div id="api-admin-test" style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);margin-top:8px;"></div>
        </div>

        <!-- SharePoint -->
        <div class="admin-card">
          <div class="admin-card-title">‚òÅÔ∏è SharePoint / OneDrive
            <span class="conn-status disconnected" id="sp-admin-status">Disconnected</span>
          </div>
          <div class="admin-input-row">
            <div>
              <label class="admin-label">SharePoint File URL</label>
              <input class="admin-input" id="adm-spUrl" placeholder="https://yourorg.sharepoint.com/sites/.../foodelo-pilot.xlsx">
            </div>
            <div>
              <label class="admin-label">Poll Interval (seconds)</label>
              <input class="admin-input" id="adm-spInterval" type="number" value="120" min="30">
            </div>
          </div>
          <div style="display:flex;gap:8px;">
            <button class="admin-save-btn" onclick="admConnectSP()">‚ö° Connect SharePoint</button>
            <button class="admin-danger-btn" onclick="admDisconnectSP()">Disconnect</button>
          </div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text-dim);margin-top:10px;">
            üí° File must be set to "Anyone with the link can view" in SharePoint permissions
          </div>
        </div>

        <!-- WebSocket -->
        <div class="admin-card">
          <div class="admin-card-title">‚ö° WebSocket Live Feed
            <span class="conn-status disconnected" id="ws-admin-status">Disconnected</span>
          </div>
          <div class="admin-input-row">
            <div>
              <label class="admin-label">WebSocket Endpoint (WSS)</label>
              <input class="admin-input" id="adm-wsUrl" placeholder="wss://api.foodelo.ng/ws/pilot">
            </div>
            <div>
              <label class="admin-label">Auth Token (optional)</label>
              <input class="admin-input" id="adm-wsToken" placeholder="Bearer token..." type="password">
            </div>
          </div>
          <div style="display:flex;gap:8px;">
            <button class="admin-save-btn" onclick="admConnectWS()">‚ö° Connect WebSocket</button>
            <button class="admin-danger-btn" onclick="admDisconnectWS()">Disconnect</button>
          </div>
        </div>

        <!-- CSV / Excel Upload -->
        <div class="admin-card">
          <div class="admin-card-title">üìä CSV / Excel File Upload</div>
          <div style="border:2px dashed var(--border-bright);border-radius:8px;padding:20px;text-align:center;cursor:pointer;transition:all 0.2s;"
               onclick="document.getElementById('adminFileInput').click()"
               onmouseover="this.style.borderColor='var(--accent5)'" onmouseout="this.style.borderColor='var(--border-bright)'">
            <div style="font-size:28px;margin-bottom:6px;">üìÇ</div>
            <div style="font-family:'Syne',sans-serif;font-size:13px;font-weight:700;margin-bottom:4px;">Drop file here or click to upload</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);">Accepts .csv, .xlsx ‚Äî columns auto-mapped to KPIs</div>
          </div>
          <input type="file" id="adminFileInput" accept=".csv,.xlsx,.json" style="display:none" onchange="admHandleFile(event)">
          <div id="adm-file-status" style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);margin-top:8px;"></div>
        </div>

        <div style="display:flex;justify-content:flex-end;">
          <button class="admin-save-btn" onclick="admSaveDataSources()">üíæ Save All Data Source Settings</button>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ USERS & ACCESS ‚îÄ‚îÄ -->
      <div class="admin-section" id="asec-users">
        <div class="admin-card">
          <div class="admin-card-title">üë• Manage Users & Passwords</div>
          <div id="userRows">
            <!-- Dynamically rendered -->
          </div>
          <div style="margin-top:12px;">
            <button class="admin-save-btn" onclick="admAddUser()">+ Add New User</button>
          </div>
        </div>

        <div class="admin-card">
          <div class="admin-card-title">üõ°Ô∏è Security Settings</div>
          <div class="admin-input-row">
            <div>
              <label class="admin-label">Max Login Attempts Before Lockout</label>
              <input class="admin-input" id="adm-maxAttempts" type="number" value="5" min="1" max="20">
            </div>
            <div>
              <label class="admin-label">Lockout Duration (seconds)</label>
              <input class="admin-input" id="adm-lockoutDur" type="number" value="60" min="10">
            </div>
          </div>
          <div class="admin-input-row">
            <div>
              <label class="admin-label">Session Timeout (hours)</label>
              <input class="admin-input" id="adm-sessionTimeout" type="number" value="4" min="1" max="24">
            </div>
            <div>
              <label class="admin-label">Require Password on Export</label>
              <select class="admin-input" id="adm-exportPwd">
                <option value="no">No ‚Äî allow free export</option>
                <option value="yes">Yes ‚Äî require password</option>
              </select>
            </div>
          </div>
          <button class="admin-save-btn" onclick="admSaveSecurity()">üíæ Save Security Settings</button>
          <div class="admin-success" id="sec-msg">‚úì Saved</div>
        </div>

        <div class="admin-card">
          <div class="admin-card-title">üìã Active Sessions</div>
          <div id="activeSessions" style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-muted);">
            Loading...
          </div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ PILOT SETTINGS ‚îÄ‚îÄ -->
      <div class="admin-section" id="asec-pilot">
        <div class="admin-card">
          <div class="admin-card-title">üìÖ Pilot Phase Configuration</div>
          <div class="admin-input-row3">
            <div>
              <label class="admin-label">Current Phase</label>
              <select class="admin-input" id="adm-phase">
                <option value="1">Month 1 ‚Äî Baseline</option>
                <option value="2">Month 2 ‚Äî Optimization</option>
                <option value="3">Month 3 ‚Äî Validation</option>
              </select>
            </div>
            <div>
              <label class="admin-label">Pilot Start Date</label>
              <input class="admin-input" id="adm-startDate" type="date">
            </div>
            <div>
              <label class="admin-label">Pilot End Date</label>
              <input class="admin-input" id="adm-endDate" type="date">
            </div>
          </div>
          <div class="admin-input-row">
            <div>
              <label class="admin-label">Month 1 Progress (%)</label>
              <input class="admin-input" id="adm-m1prog" type="number" value="68" min="0" max="100">
            </div>
            <div>
              <label class="admin-label">Month 2 Progress (%)</label>
              <input class="admin-input" id="adm-m2prog" type="number" value="0" min="0" max="100">
            </div>
          </div>
          <div>
            <label class="admin-label">Pilot Description / Notes</label>
            <textarea class="admin-input" id="adm-pilotNotes" rows="3" placeholder="Add notes about the pilot progress..." style="resize:vertical;"></textarea>
          </div>
          <button class="admin-save-btn" onclick="admSavePilot()">üíæ Update Pilot Phase</button>
          <div class="admin-success" id="pilot-msg">‚úì Pilot settings updated</div>
        </div>

        <div class="admin-card">
          <div class="admin-card-title">üè¢ Organization Settings</div>
          <div class="admin-input-row">
            <div>
              <label class="admin-label">Organization Name</label>
              <input class="admin-input" id="adm-orgName" value="InfraCredit DREEF" placeholder="Your organization">
            </div>
            <div>
              <label class="admin-label">Dashboard Title</label>
              <input class="admin-input" id="adm-dashTitle" value="Foodelo Pilot" placeholder="Dashboard title">
            </div>
          </div>
          <div class="admin-input-row">
            <div>
              <label class="admin-label">Currency Symbol</label>
              <select class="admin-input" id="adm-currency">
                <option value="‚Ç¶">‚Ç¶ Nigerian Naira</option>
                <option value="$">$ US Dollar</option>
                <option value="¬£">¬£ British Pound</option>
                <option value="‚Ç¨">‚Ç¨ Euro</option>
              </select>
            </div>
            <div>
              <label class="admin-label">Timezone</label>
              <select class="admin-input" id="adm-tz">
                <option value="Africa/Lagos">Africa/Lagos (WAT, UTC+1)</option>
                <option value="UTC">UTC</option>
                <option value="Europe/London">Europe/London</option>
                <option value="America/New_York">America/New_York</option>
              </select>
            </div>
          </div>
          <button class="admin-save-btn" onclick="admSaveOrg()">üíæ Save Organization Settings</button>
          <div class="admin-success" id="org-msg">‚úì Saved</div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ KPI TARGETS ‚îÄ‚îÄ -->
      <div class="admin-section" id="asec-kpitargets">
        <div class="admin-card">
          <div class="admin-card-title">üéØ KPI Targets ‚Äî Month 3 Goals</div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text-muted);margin-bottom:14px;">
            Edit target values. Dashboard will show red/amber/green based on actual vs target.
          </div>
          <div class="admin-grid2">
            <div>
              <label class="admin-label">Daily Orders Target</label>
              <input class="admin-input" id="tgt-orders" type="number" value="180" placeholder="180">
            </div>
            <div>
              <label class="admin-label">Monthly Revenue Target (‚Ç¶)</label>
              <input class="admin-input" id="tgt-revenue" type="number" value="6000000" placeholder="6000000">
            </div>
            <div>
              <label class="admin-label">CSAT Target (0‚Äì5)</label>
              <input class="admin-input" id="tgt-csat" type="number" step="0.1" value="4.7" placeholder="4.7">
            </div>
            <div>
              <label class="admin-label">NPS Target</label>
              <input class="admin-input" id="tgt-nps" type="number" value="75" placeholder="75">
            </div>
            <div>
              <label class="admin-label">Platform Uptime Target (%)</label>
              <input class="admin-input" id="tgt-uptime" type="number" step="0.1" value="99.9" placeholder="99.9">
            </div>
            <div>
              <label class="admin-label">Max Delivery Time (min)</label>
              <input class="admin-input" id="tgt-delivery" type="number" value="15" placeholder="15">
            </div>
            <div>
              <label class="admin-label">Payment Success Target (%)</label>
              <input class="admin-input" id="tgt-payment" type="number" step="0.1" value="99" placeholder="99">
            </div>
            <div>
              <label class="admin-label">Max Refund Rate (%)</label>
              <input class="admin-input" id="tgt-refund" type="number" step="0.1" value="1.0" placeholder="1.0">
            </div>
            <div>
              <label class="admin-label">Rider Professionalism Target (/100)</label>
              <input class="admin-input" id="tgt-rider" type="number" value="92" placeholder="92">
            </div>
            <div>
              <label class="admin-label">Merchant Acceptance Target (%)</label>
              <input class="admin-input" id="tgt-merchant" type="number" value="96" placeholder="96">
            </div>
          </div>
          <div style="margin-top:14px;">
            <button class="admin-save-btn" onclick="admSaveTargets()">üíæ Save KPI Targets</button>
            <button class="admin-danger-btn" style="margin-left:10px;" onclick="admResetTargets()">‚Ü∫ Reset to Defaults</button>
          </div>
          <div class="admin-success" id="tgt-msg">‚úì Targets saved ‚Äî dashboard updated</div>
        </div>

        <div class="admin-card">
          <div class="admin-card-title">‚ö†Ô∏è Alert Thresholds</div>
          <div class="admin-grid2">
            <div>
              <label class="admin-label">Uptime Alert Below (%)</label>
              <input class="admin-input" id="alert-uptime" type="number" step="0.1" value="99.0">
            </div>
            <div>
              <label class="admin-label">Refund Rate Alert Above (%)</label>
              <input class="admin-input" id="alert-refund" type="number" step="0.1" value="3.0">
            </div>
            <div>
              <label class="admin-label">CSAT Alert Below</label>
              <input class="admin-input" id="alert-csat" type="number" step="0.1" value="4.0">
            </div>
            <div>
              <label class="admin-label">Delivery Alert Above (min)</label>
              <input class="admin-input" id="alert-delivery" type="number" value="30">
            </div>
          </div>
          <button class="admin-save-btn" onclick="admSaveAlerts()">üíæ Save Alert Thresholds</button>
          <div class="admin-success" id="alert-msg">‚úì Alert thresholds saved</div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ DISPLAY SETTINGS ‚îÄ‚îÄ -->
      <div class="admin-section" id="asec-display">
        <div class="admin-card">
          <div class="admin-card-title">üñ•Ô∏è Dashboard Appearance</div>
          <div class="admin-input-row">
            <div>
              <label class="admin-label">Accent Color</label>
              <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;">
                <div onclick="setAccent('#f97316')" style="width:28px;height:28px;border-radius:6px;background:#f97316;cursor:pointer;border:2px solid rgba(255,255,255,0.3);" title="Orange (default)"></div>
                <div onclick="setAccent('#22d3ee')" style="width:28px;height:28px;border-radius:6px;background:#22d3ee;cursor:pointer;border:2px solid transparent;" title="Cyan"></div>
                <div onclick="setAccent('#22c55e')" style="width:28px;height:28px;border-radius:6px;background:#22c55e;cursor:pointer;border:2px solid transparent;" title="Green"></div>
                <div onclick="setAccent('#8b5cf6')" style="width:28px;height:28px;border-radius:6px;background:#8b5cf6;cursor:pointer;border:2px solid transparent;" title="Purple"></div>
                <div onclick="setAccent('#f43f5e')" style="width:28px;height:28px;border-radius:6px;background:#f43f5e;cursor:pointer;border:2px solid transparent;" title="Rose"></div>
                <div onclick="setAccent('#eab308')" style="width:28px;height:28px;border-radius:6px;background:#eab308;cursor:pointer;border:2px solid transparent;" title="Yellow"></div>
              </div>
            </div>
            <div>
              <label class="admin-label">Data Refresh Rate (seconds)</label>
              <input class="admin-input" id="adm-refreshRate" type="number" value="4" min="1" max="60">
            </div>
          </div>
          <div class="admin-toggle">
            <div><div class="toggle-label">Show Live Ticker</div><div class="toggle-sub">Scrolling alert bar at top</div></div>
            <label class="toggle-switch"><input type="checkbox" id="tog-ticker" checked onchange="toggleTicker(this)"><span class="toggle-slider"></span></label>
          </div>
          <div class="admin-toggle">
            <div><div class="toggle-label">Show Grid Background</div><div class="toggle-sub">Animated dot grid effect</div></div>
            <label class="toggle-switch"><input type="checkbox" id="tog-grid" checked onchange="toggleGrid(this)"><span class="toggle-slider"></span></label>
          </div>
          <div class="admin-toggle">
            <div><div class="toggle-label">Compact Mode</div><div class="toggle-sub">Reduce card sizes for more data density</div></div>
            <label class="toggle-switch"><input type="checkbox" id="tog-compact" onchange="toggleCompact(this)"><span class="toggle-slider"></span></label>
          </div>
          <div class="admin-toggle">
            <div><div class="toggle-label">Auto-rotate Tabs</div><div class="toggle-sub">Cycle through tabs every 30 seconds (TV mode)</div></div>
            <label class="toggle-switch"><input type="checkbox" id="tog-tvmode" onchange="toggleTVMode(this)"><span class="toggle-slider"></span></label>
          </div>
        </div>

        <div class="admin-card">
          <div class="admin-card-title">üìë Visible Tabs</div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text-muted);margin-bottom:12px;">Toggle which tabs appear in the dashboard navigation</div>
          <div id="tabToggles"></div>
          <button class="admin-save-btn" style="margin-top:12px;" onclick="admSaveDisplay()">üíæ Apply Display Settings</button>
          <div class="admin-success" id="disp-msg">‚úì Display settings applied</div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ NOTIFICATIONS ‚îÄ‚îÄ -->
      <div class="admin-section" id="asec-notifications">
        <div class="admin-card">
          <div class="admin-card-title">üîî Alert & Notification Settings</div>
          <div class="admin-toggle">
            <div><div class="toggle-label">Browser Notifications</div><div class="toggle-sub">Show desktop notifications for alerts</div></div>
            <label class="toggle-switch"><input type="checkbox" id="tog-notif" onchange="toggleNotifs(this)"><span class="toggle-slider"></span></label>
          </div>
          <div class="admin-toggle">
            <div><div class="toggle-label">Alert on Uptime Drop</div><div class="toggle-sub">Notify when uptime falls below threshold</div></div>
            <label class="toggle-switch"><input type="checkbox" id="tog-uptime-alert" checked><span class="toggle-slider"></span></label>
          </div>
          <div class="admin-toggle">
            <div><div class="toggle-label">Alert on High Refund Rate</div><div class="toggle-sub">Notify when refund rate exceeds threshold</div></div>
            <label class="toggle-switch"><input type="checkbox" id="tog-refund-alert" checked><span class="toggle-slider"></span></label>
          </div>
          <div class="admin-toggle">
            <div><div class="toggle-label">Alert on Low CSAT</div><div class="toggle-sub">Notify when CSAT drops below threshold</div></div>
            <label class="toggle-switch"><input type="checkbox" id="tog-csat-alert" checked><span class="toggle-slider"></span></label>
          </div>
          <div class="admin-toggle">
            <div><div class="toggle-label">Daily Summary Toast</div><div class="toggle-sub">Show a daily KPI summary notification at 9am</div></div>
            <label class="toggle-switch"><input type="checkbox" id="tog-daily" checked><span class="toggle-slider"></span></label>
          </div>
        </div>

        <div class="admin-card">
          <div class="admin-card-title">üìß Email / Webhook Alerts</div>
          <div class="admin-input-row">
            <div>
              <label class="admin-label">Alert Email Address</label>
              <input class="admin-input" id="adm-alertEmail" type="email" placeholder="pilot@foodelo.ng">
            </div>
            <div>
              <label class="admin-label">Webhook URL (Slack / Teams)</label>
              <input class="admin-input" id="adm-webhook" type="url" placeholder="https://hooks.slack.com/...">
            </div>
          </div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text-dim);margin-bottom:10px;">
            üí° Webhooks fire automatically when KPIs breach alert thresholds
          </div>
          <div style="display:flex;gap:8px;">
            <button class="admin-save-btn" onclick="admSaveNotifications()">üíæ Save Notification Settings</button>
            <button class="admin-danger-btn" onclick="admTestWebhook()">üß™ Test Webhook</button>
          </div>
          <div class="admin-success" id="notif-msg">‚úì Notification settings saved</div>
        </div>

        <div class="admin-card">
          <div class="admin-card-title">üìú Activity Log</div>
          <div id="activityLog" style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);max-height:200px;overflow-y:auto;"></div>
          <button class="admin-danger-btn" style="margin-top:10px;" onclick="document.getElementById('activityLog').innerHTML='';adminLog('Activity log cleared');">Clear Log</button>
        </div>
      </div>

    </div><!-- /admin-body -->
  </div><!-- /admin-panel -->
</div><!-- /adminOverlay -->

</div><!-- /main -->

<!-- Chart.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<script>

// ‚îÄ‚îÄ‚îÄ GLOBAL STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const state = {
  month: 1,
  dataSource: 'simulated',
  ws: null,
  apiInterval: null,
  uploadedData: null,
  charts: {},
};

// ‚îÄ‚îÄ‚îÄ CLOCK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateClock() {
  const now = new Date();
  document.getElementById('clock').textContent = now.toLocaleTimeString('en-GB');
  document.getElementById('headerDate').textContent = now.toLocaleDateString('en-GB', {day:'2-digit',month:'short',year:'numeric'});
}
setInterval(updateClock, 1000);
updateClock();

// ‚îÄ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchTab(name) {
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-'+name).classList.add('active');
  event.target.classList.add('active');
  initChartsForTab(name);
}

// ‚îÄ‚îÄ‚îÄ CHIPS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleChip(el, source) {
  document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  state.dataSource = source;
}
function triggerFileUpload(type) {
  document.getElementById('fileInput').click();
}

// ‚îÄ‚îÄ‚îÄ CHART DEFAULTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Chart.defaults.color = '#6b7f8f';
Chart.defaults.borderColor = 'rgba(255,255,255,0.05)';
Chart.defaults.font.family = "'JetBrains Mono', monospace";
Chart.defaults.font.size = 10;

function chartColors() {
  return {
    orange: 'rgba(249,115,22',
    cyan: 'rgba(34,211,238',
    green: 'rgba(34,197,94',
    red: 'rgba(239,68,68',
    purple: 'rgba(139,92,246',
    lime: 'rgba(163,230,53',
    yellow: 'rgba(234,179,8',
  };
}

function makeGrad(ctx, color, alpha1=0.4, alpha2=0) {
  const g = ctx.createLinearGradient(0,0,0,300);
  g.addColorStop(0, color+','+alpha1+')');
  g.addColorStop(1, color+','+alpha2+')');
  return g;
}

const days = ['W1 D1','W1 D3','W1 D5','W1 D7','W2 D1','W2 D3','W2 D5','W2 D7','W3 D1','W3 D3','W3 D5','W3 D7','W4 D1','W4 D3','W4 D5','W4 D7','W4 D7+'];
const orderData = [52,61,58,74,68,79,83,88,76,91,97,103,86,108,112,121,128];
const revData = [124800,146400,139200,177600,163200,189600,199200,211200,182400,218400,232800,247200,206400,259200,268800,290400,307200];

// ‚îÄ‚îÄ‚îÄ INIT ALL CHARTS FOR TAB ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initChartsForTab(tab) {
  if (tab === 'overview') initOverviewCharts();
  if (tab === 'financial') initFinancialCharts();
  if (tab === 'customers') initCustomerCharts();
  if (tab === 'merchants') initMerchantCharts();
  if (tab === 'tech') initTechCharts();
  if (tab === 'riders') initRiderCharts();
  if (tab === 'scalability') initScalabilityCharts();
}

function safeChart(id, config) {
  if (state.charts[id]) { state.charts[id].destroy(); }
  const ctx = document.getElementById(id);
  if (!ctx) return;
  state.charts[id] = new Chart(ctx, config);
}

// ‚îÄ‚îÄ‚îÄ OVERVIEW CHARTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initOverviewCharts() {
  const ctx = document.getElementById('orderRevenueChart');
  safeChart('orderRevenueChart', {
    type: 'bar',
    data: {
      labels: days,
      datasets: [
        {
          label: 'Orders',
          data: orderData,
          backgroundColor: makeGrad(ctx.getContext('2d'),'rgba(249,115,22',0.7,0.3),
          borderColor: '#f97316',
          borderWidth: 1,
          borderRadius: 3,
          yAxisID: 'y',
        },
        {
          label: 'Revenue (‚Ç¶)',
          data: revData,
          type: 'line',
          borderColor: '#22d3ee',
          backgroundColor: 'transparent',
          borderWidth: 2,
          pointRadius: 2,
          tension: 0.4,
          yAxisID: 'y1',
        }
      ]
    },
    options: {
      responsive:true,
      interaction:{intersect:false,mode:'index'},
      plugins:{legend:{labels:{color:'#6b7f8f',font:{size:10}}}},
      scales:{
        y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{color:'#6b7f8f'},title:{display:true,text:'Orders',color:'#6b7f8f'}},
        y1:{position:'right',grid:{drawOnChartArea:false},ticks:{color:'#22d3ee',callback:v=>'‚Ç¶'+Math.round(v/1000)+'K'},title:{display:true,text:'Revenue',color:'#22d3ee'}},
        x:{grid:{color:'rgba(255,255,255,0.03)'}}
      }
    }
  });

  safeChart('categoryChart', {
    type: 'doughnut',
    data: {
      labels: ['Swallows','Rice Dishes','Beans','Pasta','Other'],
      datasets:[{
        data:[38,34,14,10,4],
        backgroundColor:['rgba(249,115,22,0.8)','rgba(34,211,238,0.8)','rgba(34,197,94,0.8)','rgba(139,92,246,0.8)','rgba(163,230,53,0.8)'],
        borderWidth:0,
        hoverOffset:6
      }]
    },
    options:{
      responsive:true,
      cutout:'68%',
      plugins:{legend:{position:'bottom',labels:{color:'#6b7f8f',padding:10,font:{size:10}}}}
    }
  });

  safeChart('funnelChart', {
    type: 'bar',
    data: {
      labels: ['App Visits','Product Views','Cart Adds','Orders','Completed'],
      datasets:[{
        label:'Count',
        data:[4200,2860,1820,1420,1284],
        backgroundColor:['rgba(34,211,238,0.7)','rgba(34,211,238,0.6)','rgba(249,115,22,0.7)','rgba(249,115,22,0.8)','rgba(34,197,94,0.8)'],
        borderRadius:4,
        borderWidth:0
      }]
    },
    options:{
      indexAxis:'y',
      responsive:true,
      plugins:{legend:{display:false}},
      scales:{x:{grid:{color:'rgba(255,255,255,0.04)'}},y:{grid:{display:false}}}
    }
  });

  safeChart('retentionChart', {
    type:'bar',
    data:{
      labels:['30 Day','60 Day','90 Day'],
      datasets:[{
        label:'Retention %',
        data:[72,58,41],
        backgroundColor:['rgba(34,197,94,0.7)','rgba(34,211,238,0.7)','rgba(139,92,246,0.7)'],
        borderRadius:6,
        borderWidth:0
      }]
    },
    options:{
      responsive:true,
      plugins:{legend:{display:false}},
      scales:{
        y:{max:100,grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v+'%'}},
        x:{grid:{display:false}}
      }
    }
  });

  const hours = Array.from({length:14},(_,i)=>(i+8)+':00');
  const hourlyOrders = [4,8,22,38,52,61,47,28,34,56,68,72,48,22];
  safeChart('hourlyChart', {
    type:'line',
    data:{
      labels:hours,
      datasets:[{
        label:'Orders',
        data:hourlyOrders,
        borderColor:'#f97316',
        backgroundColor:'rgba(249,115,22,0.1)',
        fill:true,
        tension:0.4,
        pointRadius:2,
        borderWidth:2
      }]
    },
    options:{
      responsive:true,
      plugins:{legend:{display:false}},
      scales:{x:{grid:{color:'rgba(255,255,255,0.03)'}},y:{grid:{color:'rgba(255,255,255,0.04)'}}}
    }
  });

  buildMealsTable();
}

// ‚îÄ‚îÄ‚îÄ FINANCIAL CHARTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initFinancialCharts() {
  const weeks = ['Wk1','Wk2','Wk3','Wk4'];
  safeChart('finRevExpChart', {
    type:'line',
    data:{
      labels:weeks,
      datasets:[
        {label:'Gross Revenue',data:[680000,820000,940000,1080000],borderColor:'#f97316',backgroundColor:'rgba(249,115,22,0.1)',fill:true,tension:0.4,borderWidth:2,pointRadius:3},
        {label:'Op Expenses',data:[210000,240000,270000,280000],borderColor:'#ef4444',backgroundColor:'rgba(239,68,68,0.08)',fill:true,tension:0.4,borderWidth:2,pointRadius:3},
        {label:'Net Revenue',data:[470000,580000,670000,800000],borderColor:'#22c55e',backgroundColor:'rgba(34,197,94,0.06)',fill:true,tension:0.4,borderWidth:2,pointRadius:3}
      ]
    },
    options:{
      responsive:true,
      interaction:{mode:'index',intersect:false},
      plugins:{legend:{labels:{color:'#6b7f8f'}}},
      scales:{
        y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>'‚Ç¶'+(v/1000).toFixed(0)+'K'}},
        x:{grid:{color:'rgba(255,255,255,0.03)'}}
      }
    }
  });

  safeChart('costBreakChart', {
    type:'doughnut',
    data:{
      labels:['Rider Payouts','Incentives','Customer Support','Marketing','Tech/Infra'],
      datasets:[{
        data:[42,22,16,12,8],
        backgroundColor:['rgba(249,115,22,0.8)','rgba(234,179,8,0.8)','rgba(34,211,238,0.8)','rgba(139,92,246,0.8)','rgba(163,230,53,0.8)'],
        borderWidth:0
      }]
    },
    options:{responsive:true,cutout:'60%',plugins:{legend:{position:'bottom',labels:{color:'#6b7f8f',padding:8,font:{size:10}}}}}
  });

  const allMonths = ['M1 W1','M1 W2','M1 W3','M1 W4','M2 W1','M2 W2','M2 W3','M2 W4','M3 W1','M3 W2','M3 W3','M3 W4'];
  const projRev = [680,820,940,1080,1150,1280,1400,1560,1650,1820,2050,2280].map(v=>v*1000);
  safeChart('revenueGrowthChart', {
    type:'line',
    data:{
      labels:allMonths,
      datasets:[
        {label:'Actual Revenue',data:[680000,820000,940000,1080000,null,null,null,null,null,null,null,null],borderColor:'#f97316',borderWidth:2.5,pointRadius:3,tension:0.4},
        {label:'Projected',data:[null,null,null,1080000,1150000,1280000,1400000,1560000,1650000,1820000,2050000,2280000],borderColor:'rgba(249,115,22,0.4)',borderDash:[5,4],borderWidth:1.5,pointRadius:2,tension:0.4}
      ]
    },
    options:{
      responsive:true,
      interaction:{mode:'index',intersect:false},
      plugins:{
        legend:{labels:{color:'#6b7f8f'}},
        annotation:{annotations:{box1:{type:'box',xMin:3.5,xMax:7.5,backgroundColor:'rgba(34,211,238,0.03)',borderColor:'rgba(34,211,238,0.1)',label:{display:true,content:'Month 2',color:'rgba(34,211,238,0.4)'}}}}
      },
      scales:{
        y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>'‚Ç¶'+(v/1000).toFixed(0)+'K'}},
        x:{grid:{color:'rgba(255,255,255,0.03)'}}
      }
    }
  });
}

// ‚îÄ‚îÄ‚îÄ CUSTOMER CHARTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initCustomerCharts() {
  safeChart('retentionCohortChart', {
    type:'bar',
    data:{
      labels:['Week 1','Week 2','Week 3','Week 4'],
      datasets:[
        {label:'30-Day Cohort',data:[100,84,76,72],backgroundColor:'rgba(34,197,94,0.7)',borderRadius:3},
        {label:'60-Day Cohort',data:[100,72,65,58],backgroundColor:'rgba(34,211,238,0.7)',borderRadius:3},
        {label:'90-Day Cohort',data:[100,60,48,41],backgroundColor:'rgba(139,92,246,0.7)',borderRadius:3}
      ]
    },
    options:{
      responsive:true,
      plugins:{legend:{labels:{color:'#6b7f8f'}}},
      scales:{
        y:{max:100,grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v+'%'}},
        x:{grid:{display:false}}
      }
    }
  });

  safeChart('reviewChart', {
    type:'bar',
    data:{
      labels:['‚≠ê','‚≠ê‚≠ê','‚≠ê‚≠ê‚≠ê','‚≠ê‚≠ê‚≠ê‚≠ê','‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'],
      datasets:[
        {label:'Merchant Reviews',data:[12,28,84,198,312],backgroundColor:'rgba(249,115,22,0.7)',borderRadius:4},
        {label:'Rider Reviews',data:[8,18,62,214,286],backgroundColor:'rgba(34,211,238,0.7)',borderRadius:4}
      ]
    },
    options:{
      responsive:true,
      plugins:{legend:{labels:{color:'#6b7f8f'}}},
      scales:{x:{grid:{display:false}},y:{grid:{color:'rgba(255,255,255,0.04)'}}}
    }
  });
}

// ‚îÄ‚îÄ‚îÄ MERCHANT CHARTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initMerchantCharts() {
  const merchants = ['Mama Titi','Sule Buka','Joy Kitchen','Abuja Pot','GrillHouse','Iya Basira','Mama Emeka','FoodZone'];
  safeChart('merchantOrdersChart', {
    type:'bar',
    data:{
      labels:merchants,
      datasets:[{
        label:'Completed Orders',
        data:[182,161,143,128,112,98,87,76],
        backgroundColor:['rgba(249,115,22,0.8)','rgba(249,115,22,0.7)','rgba(249,115,22,0.6)','rgba(34,211,238,0.7)','rgba(34,211,238,0.6)','rgba(139,92,246,0.6)','rgba(139,92,246,0.5)','rgba(163,230,53,0.6)'],
        borderRadius:4,borderWidth:0
      }]
    },
    options:{
      responsive:true,plugins:{legend:{display:false}},
      scales:{x:{grid:{display:false},ticks:{maxRotation:30,font:{size:9}}},y:{grid:{color:'rgba(255,255,255,0.04)'}}}
    }
  });

  safeChart('deliveryTimelineChart', {
    type:'bar',
    data:{
      labels:merchants,
      datasets:[
        {label:'Prep Time',data:[12,15,10,18,8,14,11,16],backgroundColor:'rgba(249,115,22,0.7)',borderRadius:3},
        {label:'Delivery Time',data:[18,16,14,20,15,17,13,19],backgroundColor:'rgba(34,211,238,0.7)',borderRadius:3}
      ]
    },
    options:{
      responsive:true,
      plugins:{legend:{labels:{color:'#6b7f8f'}}},
      scales:{
        x:{stacked:false,grid:{display:false},ticks:{maxRotation:30,font:{size:9}}},
        y:{grid:{color:'rgba(255,255,255,0.04)'},title:{display:true,text:'Minutes',color:'#6b7f8f'}}
      }
    }
  });

  buildMerchantTable();
}

// ‚îÄ‚îÄ‚îÄ TECH CHARTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initTechCharts() {
  const hrs24 = Array.from({length:24},(_,i)=>i+':00');
  const uptimeArr = hrs24.map(()=>parseFloat((99.2+Math.random()*0.8).toFixed(2)));
  safeChart('uptimeChart', {
    type:'line',
    data:{
      labels:hrs24,
      datasets:[{
        label:'Uptime %',
        data:uptimeArr,
        borderColor:'#22c55e',
        backgroundColor:'rgba(34,197,94,0.08)',
        fill:true,tension:0.3,pointRadius:1,borderWidth:2
      }]
    },
    options:{
      responsive:true,plugins:{legend:{display:false}},
      scales:{
        y:{min:98,max:100,grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v+'%'}},
        x:{grid:{color:'rgba(255,255,255,0.02)'},ticks:{maxTicksLimit:8}}
      }
    }
  });

  safeChart('paymentSplitChart', {
    type:'doughnut',
    data:{
      labels:['Card','Bank Transfer','Wallet','USSD','Cash on Delivery'],
      datasets:[{
        data:[38,28,22,8,4],
        backgroundColor:['rgba(249,115,22,0.8)','rgba(34,211,238,0.8)','rgba(163,230,53,0.8)','rgba(139,92,246,0.8)','rgba(239,68,68,0.7)'],
        borderWidth:0
      }]
    },
    options:{responsive:true,cutout:'65%',plugins:{legend:{position:'bottom',labels:{color:'#6b7f8f',padding:8,font:{size:10}}}}}
  });

  const weeks7 = ['W1','W2','W3','W4','W5','W6','W7'];
  safeChart('techTrendChart', {
    type:'line',
    data:{
      labels:weeks7,
      datasets:[
        {label:'Uptime %',data:[98.4,99.1,99.2,99.5,99.7,99.6,99.7],borderColor:'#22c55e',borderWidth:2,tension:0.4,pointRadius:2,yAxisID:'y'},
        {label:'Payment Success %',data:[94.2,95.8,96.4,97.0,97.2,97.1,97.2],borderColor:'#a3e635',borderWidth:2,tension:0.4,pointRadius:2,yAxisID:'y'},
        {label:'Failed Tx %',data:[5.8,4.2,3.6,3.0,2.8,2.9,2.8],borderColor:'#ef4444',borderWidth:1.5,borderDash:[4,3],tension:0.4,pointRadius:2,yAxisID:'y2'}
      ]
    },
    options:{
      responsive:true,
      interaction:{mode:'index',intersect:false},
      plugins:{legend:{labels:{color:'#6b7f8f'}}},
      scales:{
        y:{position:'left',min:90,max:101,grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v+'%'}},
        y2:{position:'right',min:0,max:10,grid:{drawOnChartArea:false},ticks:{callback:v=>v+'%',color:'#ef4444'}},
        x:{grid:{color:'rgba(255,255,255,0.03)'}}
      }
    }
  });
}

// ‚îÄ‚îÄ‚îÄ RIDER CHARTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initRiderCharts() {
  safeChart('profRadarChart', {
    type:'radar',
    data:{
      labels:['Appearance','Communication','Conduct','Reliability','Customer FB','Training'],
      datasets:[{
        label:'Pilot Average',
        data:[87,83,92,79,81,74],
        borderColor:'rgba(249,115,22,0.8)',
        backgroundColor:'rgba(249,115,22,0.15)',
        pointBackgroundColor:'#f97316',
        borderWidth:2,
        pointRadius:4
      }]
    },
    options:{
      responsive:true,
      plugins:{legend:{display:false}},
      scales:{r:{min:0,max:100,grid:{color:'rgba(255,255,255,0.06)'},angleLines:{color:'rgba(255,255,255,0.06)'},ticks:{stepSize:25,color:'#3a4f5e',backdropColor:'transparent'},pointLabels:{color:'#6b7f8f',font:{size:10}}}}
    }
  });

  safeChart('riderIssueChart', {
    type:'bar',
    data:{
      labels:['Complaints','Late Delivery','Misconduct','No-Show','App Issues'],
      datasets:[{
        label:'Issues (Month 1)',
        data:[8,14,2,4,6],
        backgroundColor:['rgba(239,68,68,0.7)','rgba(234,179,8,0.7)','rgba(239,68,68,0.9)','rgba(249,115,22,0.7)','rgba(139,92,246,0.7)'],
        borderRadius:4,borderWidth:0
      }]
    },
    options:{
      indexAxis:'y',
      responsive:true,plugins:{legend:{display:false}},
      scales:{x:{grid:{color:'rgba(255,255,255,0.04)'}},y:{grid:{display:false}}}
    }
  });

  buildRiderTable();
}

// ‚îÄ‚îÄ‚îÄ SCALABILITY CHARTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initScalabilityCharts() {
  safeChart('efficiencyChart', {
    type:'radar',
    data:{
      labels:['Order Volume','Delivery Speed','Cost Efficiency','Rider Utilization','Merchant Performance','Customer Sat.'],
      datasets:[
        {label:'Month 1 (Actual)',data:[55,62,58,68,72,74],borderColor:'rgba(249,115,22,0.8)',backgroundColor:'rgba(249,115,22,0.12)',borderWidth:2,pointRadius:3},
        {label:'Month 3 (Target)',data:[90,85,80,88,90,92],borderColor:'rgba(34,211,238,0.8)',backgroundColor:'rgba(34,211,238,0.08)',borderWidth:2,pointRadius:3,borderDash:[4,3]}
      ]
    },
    options:{
      responsive:true,
      plugins:{legend:{labels:{color:'#6b7f8f'}}},
      scales:{r:{min:0,max:100,grid:{color:'rgba(255,255,255,0.06)'},angleLines:{color:'rgba(255,255,255,0.06)'},ticks:{stepSize:25,color:'#3a4f5e',backdropColor:'transparent'},pointLabels:{color:'#6b7f8f',font:{size:10}}}}
    }
  });

  safeChart('scaleChart', {
    type:'bar',
    data:{
      labels:['Riders','Merchants','Tech Infra','Order Volume','Support Ops','Financial'],
      datasets:[
        {label:'Current Capacity (1x)',data:[100,100,100,100,100,100],backgroundColor:'rgba(255,255,255,0.05)',borderRadius:4},
        {label:'Scale Headroom (2x)',data:[210,180,195,215,160,200],backgroundColor:'rgba(34,211,238,0.2)',borderRadius:4},
        {label:'5x Target',data:[500,500,500,500,500,500],backgroundColor:'rgba(249,115,22,0.1)',borderRadius:4,borderDash:[4,3]}
      ]
    },
    options:{
      responsive:true,
      plugins:{legend:{labels:{color:'#6b7f8f'}}},
      scales:{
        x:{grid:{display:false}},
        y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v+'%'}}
      }
    }
  });

  buildPilotSummaryTable();
}

// ‚îÄ‚îÄ‚îÄ TABLE BUILDERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const meals = [
  'Pounded Yam, Egusi, Beef & Fish','Jollof Rice Plantain, Beef & Chicken','Fried Rice Coleslaw, Beef & Chicken',
  'Amala Ewedu Gbegiri & Assorted','Ofada Rice & Sauce Plantain','Eba & Efo Riro Beef & Fish',
  'Jollof Rice Moimoi, Beef & Chicken','Poundo Yam, Edikaikong','Beans with Plantain Fish & Beef',
  'Native Rice Plantain, Beef & Chicken','Spaghetti Jollof, Plantain','Yam Porridge Fish & Beef',
  'Ewa Agoyin Bread, Fish & Beef','Semovita & Efo Riro','Asun Rice, Plantain',
  'Eba Okro, Fish & Beef','Porridge Bean, Plantain','Rice & Beans Plantain',
  'Stir Fry Pasta Plantain','Poundo Yam, Egusi','Poundo Okro, Beef & Fish',
  'Ofada Rice, Plantain Beef','Jollof Rice Coleslaw, Beef & Chicken'
];
const mealOrders = [142,138,124,118,112,108,104,98,94,88,82,76,72,68,64,58,54,48,44,40,36,32,28];

function buildMealsTable() {
  const tbody = document.getElementById('mealsTable');
  if(!tbody) return;
  tbody.innerHTML = mealOrders.map((cnt, i) => {
    const rev = cnt * (2200 + Math.floor(Math.random()*600));
    const rating = (3.8 + Math.random()*1.2).toFixed(1);
    const trend = cnt > 80 ? '<span class="delta-up">‚ñ≤</span>' : '<span style="color:var(--text-muted)">‚Üí</span>';
    const status = cnt > 100 ? '<span class="pill green">üî• Hot</span>' : cnt > 60 ? '<span class="pill orange">Active</span>' : '<span class="pill yellow">Steady</span>';
    const bg = i < 3 ? 'rgba(249,115,22,0.05)' : 'transparent';
    return `<tr style="background:${bg}">
      <td><span class="rank-badge" style="background:${i===0?'rgba(249,115,22,0.2)':i===1?'rgba(100,100,100,0.15)':'rgba(60,60,60,0.1)'}; color:${i===0?'var(--accent)':'var(--text-muted)'}">${i+1}</span></td>
      <td style="color:var(--text)">${meals[i]}</td>
      <td style="color:var(--accent)">${cnt}</td>
      <td>‚Ç¶${(rev/1000).toFixed(1)}K</td>
      <td><span style="color:var(--yellow)">‚òÖ</span> ${rating}</td>
      <td>${trend}</td>
      <td>${status}</td>
    </tr>`;
  }).join('');
}

const merchantNames = ['Mama Titi Kitchen','Sule Buka','Joy\'s Kitchen','Abuja Pot','GrillHouse NG','Iya Basira','Mama Emeka','FoodZone','Naija Flavours','Lagos Table','Quick Bites','Eko Kitchen'];
function buildMerchantTable() {
  const tbody = document.getElementById('merchantTable');
  if(!tbody) return;
  const orders = [182,161,143,128,112,98,87,76,68,54,48,42];
  tbody.innerHTML = orders.map((o,i) => {
    const acc = (85+Math.random()*14).toFixed(1);
    const prep = (8+Math.random()*12).toFixed(0);
    const sat = (3.5+Math.random()*1.5).toFixed(1);
    const esc = Math.floor(Math.random()*4);
    const status = acc > 93 ? '<span class="pill green">Top</span>' : acc > 87 ? '<span class="pill orange">Good</span>' : '<span class="pill yellow">Watch</span>';
    return `<tr>
      <td><span class="rank-badge" style="background:rgba(249,115,22,0.1);color:var(--accent)">${i+1}</span></td>
      <td style="color:var(--text)">${merchantNames[i]}</td>
      <td style="color:var(--accent)">${o}</td>
      <td>${acc}%</td>
      <td>${prep} min</td>
      <td><span style="color:var(--yellow)">‚òÖ</span> ${sat}</td>
      <td style="color:${esc>2?'var(--red)':'var(--text-muted)'}">${esc}</td>
      <td>${status}</td>
    </tr>`;
  }).join('');
}

const riderIds = ['EMK-01','EMK-02','EMK-03','EMK-04','EMK-05','EMK-06','EMK-07','EMK-08','EMK-09','EMK-10','EMK-11','EMK-12'];
function buildRiderTable() {
  const tbody = document.getElementById('riderTable');
  if(!tbody) return;
  tbody.innerHTML = riderIds.map((id,i) => {
    const opd = (8+Math.random()*8).toFixed(1);
    const del = (16+Math.random()*12).toFixed(0);
    const prof = (68+Math.random()*30).toFixed(0);
    const comp = Math.floor(Math.random()*3);
    const earn = (6000+Math.random()*4000).toFixed(0);
    const status = prof > 85 ? '<span class="pill green">‚òÖ Pro</span>' : prof > 74 ? '<span class="pill orange">Good</span>' : '<span class="pill yellow">Developing</span>';
    return `<tr>
      <td><span class="rank-badge" style="background:rgba(34,211,238,0.1);color:var(--accent2)">${i+1}</span></td>
      <td style="color:var(--text)">${id}</td>
      <td style="color:var(--accent)">${opd}</td>
      <td>${del} min</td>
      <td style="color:${prof>85?'var(--green)':prof>74?'var(--accent)':'var(--yellow)'}">${prof}/100</td>
      <td style="color:${comp>1?'var(--red)':'var(--text-muted)'}">${comp}</td>
      <td>‚Ç¶${parseInt(earn).toLocaleString()}</td>
      <td>${status}</td>
    </tr>`;
  }).join('');
}

function buildPilotSummaryTable() {
  const tbody = document.getElementById('pilotSummaryTable');
  if(!tbody) return;
  const rows = [
    ['Daily Orders','86','120‚Äì150','180+ (min viable 68)','<span class="pill green">On Track</span>'],
    ['Revenue (Monthly)','‚Ç¶3.08M','‚Ç¶4.2M','‚Ç¶6.0M+','<span class="pill green">On Track</span>'],
    ['Avg Delivery Time','22 min','18 min','‚â§15 min','<span class="pill yellow">Improving</span>'],
    ['CSAT Score','4.3/5','4.5/5','4.7/5','<span class="pill green">On Track</span>'],
    ['Rider Prof. Score','82/100','88/100','92+/100','<span class="pill green">On Track</span>'],
    ['Platform Uptime','99.7%','99.8%','99.9%','<span class="pill green">On Track</span>'],
    ['Payment Success','97.2%','98%','99%+','<span class="pill green">On Track</span>'],
    ['Merchant Acceptance','91.4%','94%','96%+','<span class="pill orange">Watch</span>'],
    ['Refund Rate','1.8%','1.2%','<1%','<span class="pill green">Improving</span>'],
    ['Scale Readiness','2.1x','3.5x','5x ready','<span class="pill yellow">Building</span>'],
  ];
  tbody.innerHTML = rows.map(r=>`<tr>
    <td style="color:var(--text)">${r[0]}</td>
    <td style="color:var(--accent)">${r[1]}</td>
    <td style="color:var(--accent2)">${r[2]}</td>
    <td style="color:var(--green)">${r[3]}</td>
    <td>${r[4]}</td>
  </tr>`).join('');
}

// ‚îÄ‚îÄ‚îÄ LIVE DATA SIMULATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function liveUpdate() {
  const fluctuate = (base, pct) => {
    const delta = base * pct * (Math.random() - 0.5);
    return Math.round(base + delta);
  };
  const kpiOrders = document.getElementById('kpi-orders');
  if (kpiOrders) {
    const newOrders = fluctuate(1284, 0.01);
    kpiOrders.textContent = newOrders.toLocaleString();
  }
  const delivery = document.getElementById('kpi-delivery');
  if (delivery) {
    const mins = fluctuate(22, 0.05);
    delivery.innerHTML = mins + '<span style="font-size:13px">min</span>';
  }
  const uptime = document.getElementById('kpi-uptime');
  if (uptime) {
    const val = (99.5 + Math.random()*0.5).toFixed(1);
    uptime.textContent = val + '%';
  }
}
setInterval(liveUpdate, 4000);

// ‚îÄ‚îÄ‚îÄ WEBSOCKET ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function connectWebSocket() {
  // Simulate WebSocket connection (replace URL with actual endpoint)
  const wsUrl = 'wss://your-foodelo-ws-endpoint.ng/pilot';
  document.getElementById('wsLabel').textContent = 'Connecting...';

  // Demo: simulate successful connection
  setTimeout(()=>{
    document.getElementById('wsLabel').textContent = 'WSS Simulated';
    document.getElementById('wsDot').className = 'ws-dot connected';
    showToast('WebSocket feed active ‚Äî real-time streaming enabled');
  }, 1500);

  // In production, replace with:
  // state.ws = new WebSocket(wsUrl);
  // state.ws.onmessage = (e) => { const d = JSON.parse(e.data); ingestData(d); };
}

// ‚îÄ‚îÄ‚îÄ API CONNECTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showAPIConfig() { document.getElementById('apiConfigPanel').style.display = 'block'; switchTab('connect'); }
function showSharePointConfig() { document.getElementById('sharePointPanel').style.display = 'block'; switchTab('connect'); }
function showGoogleSheets() {
  document.getElementById('googleSheetsPanel').style.display = 'block';
  switchTab('connect');
}

// ‚îÄ‚îÄ‚îÄ GOOGLE SHEETS CONNECTOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let gsInterval = null;

function parseGoogleSheetURL(raw) {
  raw = raw.trim();
  if (raw.includes('export?format=csv') || raw.includes('output=csv')) return raw;
  const match = raw.match(/spreadsheets\/d\/([a-zA-Z0-9_-]+)/);
  if (!match) return null;
  const sheetId = match[1];
  const gidMatch = raw.match(/[#&?]gid=(\d+)/);
  const gid = gidMatch ? gidMatch[1] : '0';
  return `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=${gid}`;
}

function parseCSV(text) {
  const lines = text.trim().split('\n');
  if (lines.length < 2) return [];
  const headers = lines[0].split(',').map(h => h.replace(/"/g,'').trim().toLowerCase()
    .replace(/\s+/g,'_').replace(/[^a-z0-9_]/g,''));
  return lines.slice(1).map(line => {
    const cols = [];
    let cur = '', inQ = false;
    for (let ch of line) {
      if (ch === '"') { inQ = !inQ; continue; }
      if (ch === ',' && !inQ) { cols.push(cur.trim()); cur = ''; continue; }
      cur += ch;
    }
    cols.push(cur.trim());
    const obj = {};
    headers.forEach((h, i) => obj[h] = cols[i] || '');
    return obj;
  });
}

const COL_MAP = {
  total_orders:['total_orders','completed_orders','orders','order_count','total_completed'],
  revenue:['revenue','gross_revenue','rev','total_revenue','sales'],
  opex:['opex','operational_expenses','op_expenses','expenses','operational_cost'],
  net_revenue:['net_revenue','net_rev','net_income','profit'],
  refund_rate:['refund_rate','refunds','refund_percent'],
  dau:['dau','daily_active_users','daily_users','daily_visits'],
  csat:['csat','customer_satisfaction','satisfaction_score','csat_score'],
  nps:['nps','net_promoter_score','net_promoter'],
  avg_delivery:['avg_delivery','average_delivery','delivery_time','avg_delivery_time'],
  platform_uptime:['uptime','platform_uptime','system_uptime'],
  payment_success:['payment_success','payment_success_rate'],
  active_riders:['active_riders','riders','rider_count'],
  refund_rate:['refund_rate','refunds','refund_percent'],
};

function findCol(row, field) {
  const aliases = COL_MAP[field] || [field];
  for (const alias of aliases) {
    if (row[alias] !== undefined && row[alias] !== '') return row[alias];
  }
  return null;
}

function cleanNum(val) {
  if (val === null || val === undefined || val === '') return null;
  const s = String(val).replace(/‚Ç¶|\$|,/g,'').trim();
  const m = s.match(/([\d.]+)([KkMm]?)/);
  if (!m) return null;
  let n = parseFloat(m[1]);
  if (m[2].toLowerCase()==='k') n*=1000;
  if (m[2].toLowerCase()==='m') n*=1000000;
  return isNaN(n)?null:n;
}

function applySheetData(rows) {
  if (!rows || rows.length === 0) { showToast('‚ö† Sheet empty or unreadable'); return; }
  const latest = rows[rows.length - 1];
  const updates = [
    ['kpi-orders',  findCol(latest,'total_orders'),    v => v.toLocaleString()],
    ['kpi-rev',     findCol(latest,'revenue'),         v => '‚Ç¶'+(v>=1e6?(v/1e6).toFixed(2)+'M':(v/1000).toFixed(0)+'K')],
    ['kpi-opex',    findCol(latest,'opex'),            v => '‚Ç¶'+(v>=1e6?(v/1e6).toFixed(2)+'M':(v/1000).toFixed(0)+'K')],
    ['kpi-csat',    findCol(latest,'csat'),            v => v.toFixed(1)+'/5'],
    ['kpi-nps',     findCol(latest,'nps'),             v => Math.round(v)+''],
    ['kpi-delivery',findCol(latest,'avg_delivery'),    v => Math.round(v)+'<span style="font-size:13px">min</span>'],
    ['kpi-uptime',  findCol(latest,'platform_uptime'), v => v.toFixed(1)+'%'],
    ['kpi-payment', findCol(latest,'payment_success'), v => v.toFixed(1)+'%'],
    ['kpi-riders',  findCol(latest,'active_riders'),   v => Math.round(v)+''],
    ['kpi-refund',  findCol(latest,'refund_rate'),     v => v.toFixed(1)+'<span style="font-size:13px">%</span>'],
  ];
  let updated = 0;
  updates.forEach(([id, raw, fmt]) => {
    const el = document.getElementById(id);
    if (!el || raw === null) return;
    const num = cleanNum(raw);
    if (num === null) return;
    el.innerHTML = fmt(num);
    el.style.transition = 'color 0.6s';
    el.style.color = 'var(--accent2)';
    setTimeout(()=> el.style.color = '', 1400);
    updated++;
  });
  // Preview table
  const preview = document.getElementById('gsPreviewTable');
  if (preview && rows.length > 0) {
    const cols = Object.keys(rows[0]).slice(0,9);
    preview.innerHTML = `<thead><tr>${cols.map(c=>`<th>${c}</th>`).join('')}</tr></thead>
      <tbody>${rows.slice(-4).map(r=>`<tr>${cols.map(c=>`<td>${r[c]||''}</td>`).join('')}</tr>`).join('')}</tbody>`;
  }
  document.getElementById('gsStatus').innerHTML =
    `<span style="color:var(--green)">‚úì Synced ‚Äî ${rows.length} rows, ${updated} KPIs updated</span>
     <span style="color:var(--text-dim);margin-left:12px;">Last sync: ${new Date().toLocaleTimeString()}</span>`;
  document.getElementById('wsDot').className = 'ws-dot connected';
  document.getElementById('wsLabel').textContent = 'Sheets Live';
  document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  showToast(`Google Sheets synced ‚Äî ${rows.length} rows, ${updated} KPIs updated`);
}

async function connectGoogleSheets() {
  const raw = document.getElementById('gsUrl').value.trim();
  if (!raw) {
    document.getElementById('gsStatus').innerHTML = '<span style="color:var(--red)">‚ö† Please paste your Google Sheets link</span>';
    return;
  }
  const csvUrl = parseGoogleSheetURL(raw);
  if (!csvUrl) {
    document.getElementById('gsStatus').innerHTML = '<span style="color:var(--red)">‚ö† Invalid URL. Paste the full Google Sheets link.</span>';
    return;
  }
  const btn = document.getElementById('gsConnectBtn');
  btn.textContent = '‚è≥ Connecting...';
  btn.disabled = true;
  document.getElementById('gsStatus').innerHTML = '<span style="color:var(--yellow)">‚è≥ Fetching sheet data...</span>';
  const secs = parseInt(document.getElementById('gsInterval').value || '60') * 1000;

  const fetchAndApply = async () => {
    try {
      const proxy = 'https://corsproxy.io/?';
      const res = await fetch(proxy + encodeURIComponent(csvUrl));
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const text = await res.text();
      if (text.includes('<html')) throw new Error('Sheet is not public. Publish it first (see instructions below).');
      const rows = parseCSV(text);
      applySheetData(rows);
      btn.textContent = '‚úì Connected';
      btn.style.background = 'var(--green)';
    } catch(err) {
      document.getElementById('gsStatus').innerHTML =
        `<span style="color:var(--red)">‚ö† ${err.message}</span>`;
      btn.textContent = 'Connect Google Sheets';
      btn.disabled = false;
    }
  };

  await fetchAndApply();
  if (gsInterval) clearInterval(gsInterval);
  gsInterval = setInterval(fetchAndApply, secs);
}

function disconnectGoogleSheets() {
  if (gsInterval) { clearInterval(gsInterval); gsInterval = null; }
  const btn = document.getElementById('gsConnectBtn');
  if(btn){btn.textContent='Connect Google Sheets';btn.disabled=false;btn.style.background='';}
  document.getElementById('gsStatus').innerHTML = '<span style="color:var(--text-muted)">Disconnected</span>';
  document.getElementById('wsDot').className = 'ws-dot simulated';
  document.getElementById('wsLabel').textContent = 'Simulated Feed';
  showToast('Google Sheets disconnected');
}

function connectAPI() {
  const url = document.getElementById('apiUrl').value;
  const key = document.getElementById('apiKey').value;
  const interval = parseInt(document.getElementById('pollInterval').value) * 1000;
  if (!url || !key) { document.getElementById('apiStatus').textContent = '‚ö† Please provide API URL and key.'; return; }
  document.getElementById('apiStatus').textContent = '‚è≥ Testing connection...';
  if (state.apiInterval) clearInterval(state.apiInterval);
  // Simulate connection test
  setTimeout(()=>{
    document.getElementById('apiStatus').innerHTML = '<span style="color:var(--green)">‚úì Connected. Polling every '+(interval/1000)+'s</span>';
    document.getElementById('wsDot').className = 'ws-dot connected';
    document.getElementById('wsLabel').textContent = 'API Live';
    state.apiInterval = setInterval(()=> {
      // fetch(url+'/pilot/metrics', {headers:{'X-API-Key':key}}).then(r=>r.json()).then(ingestData)
      liveUpdate(); // simulated
    }, interval);
    showToast('Foodelo API connected! Data refreshing every ' + (interval/1000) + 's');
  }, 1200);
}

function testAPIConnection() {
  document.getElementById('apiStatus').textContent = '‚è≥ Pinging...';
  setTimeout(()=>{
    document.getElementById('apiStatus').innerHTML = '<span style="color:var(--yellow)">‚ö† Simulation mode ‚Äî replace URL with real Foodelo endpoint</span>';
  }, 800);
}

function connectSharePoint() {
  const url = document.getElementById('spUrl').value;
  if (!url) return;
  showToast('SharePoint sync configured. Note: Server-side CORS proxy may be required.');
}

// ‚îÄ‚îÄ‚îÄ FILE UPLOAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function handleFileUpload(event) {
  const file = event.target.files[0];
  if (!file) return;
  const ext = file.name.split('.').pop().toLowerCase();
  const feedback = document.getElementById('uploadFeedback');
  if (feedback) {
    feedback.innerHTML = `<div class="pill green">‚úì File received: ${file.name} (${(file.size/1024).toFixed(1)}KB)</div>
    <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-muted);margin-top:8px;">
      Auto-detecting columns... Mapping to dashboard KPIs...<br>
      <span style="color:var(--green)">‚úì date ‚Üí Date Column</span><br>
      <span style="color:var(--green)">‚úì revenue/total_orders ‚Üí Financial KPIs</span><br>
      <span style="color:var(--accent2)">‚Ñπ Upload to Connect Data tab to finalize mapping.</span>
    </div>`;
  }
  showToast(`${file.name} uploaded. ${ext === 'csv' ? 'CSV' : 'Excel'} data ingested into dashboard.`);
  document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  document.getElementById('chip-excel') && document.getElementById('chip-excel').classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ INGEST DATA (generic) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function ingestData(d) {
  // Map incoming JSON data fields to dashboard KPIs
  const map = {
    total_orders: 'kpi-orders', revenue: 'kpi-rev', csat: 'kpi-csat',
    nps: 'kpi-nps', platform_uptime: 'kpi-uptime', avg_delivery: 'kpi-delivery',
    refund_rate: 'kpi-refund', payment_success: 'kpi-payment',
    active_riders: 'kpi-riders', opex: 'kpi-opex'
  };
  for (const [key, elId] of Object.entries(map)) {
    if (d[key] !== undefined) {
      const el = document.getElementById(elId);
      if (el) el.textContent = d[key];
    }
  }
}

// ‚îÄ‚îÄ‚îÄ EXPORT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function exportData() {
  const csv = [
    ['Metric','Value','Change'],
    ['Total Orders','1,284','+12.4%'],
    ['Revenue','‚Ç¶3.08M','+8.1%'],
    ['OpEx','‚Ç¶820K',''],
    ['Net Revenue','‚Ç¶2.26M','+9.2%'],
    ['Platform Uptime','99.7%','‚úì SLA'],
    ['CSAT Score','4.3/5','+0.2'],
    ['NPS','62','Good'],
    ['Avg Delivery','22 min','-3min'],
    ['Refund Rate','1.8%','‚ñº improving'],
    ['Payment Success','97.2%','+1.1%'],
    ['Active Riders','24','+4'],
  ].map(r=>r.join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'foodelo_pilot_dashboard_' + new Date().toISOString().slice(0,10) + '.csv';
  a.click();
  showToast('Dashboard data exported as CSV');
}

function refreshAll() {
  liveUpdate();
  showToast('Dashboard refreshed ‚Äî ' + new Date().toLocaleTimeString());
}

// ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(msg) {
  const t = document.createElement('div');
  t.style.cssText = `position:fixed;bottom:24px;right:24px;z-index:9999;background:#111920;border:1px solid rgba(249,115,22,0.4);border-radius:8px;padding:10px 16px;font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text);max-width:320px;animation:slideIn 0.3s ease;box-shadow:0 8px 32px rgba(0,0,0,0.4)`;
  t.textContent = '‚ö° ' + msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(), 3500);
}


// ‚ïê‚ïê AUTH & LOGIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const USERS = {
  admin:   { pass:'Foodelo@2025', role:'Executive',  access:'all' },
  ops:     { pass:'Pilot@Ops',    role:'Operations', access:'ops' },
  finance: { pass:'Fin@2025',     role:'Finance',    access:'fin' },
  viewer:  { pass:'View@Pilot',   role:'Viewer',     access:'view' },
};

let currentUser = null;
let selectedRole = 'Executive';
let sessionStart = null;
let sessionTimerInterval = null;
let loginAttempts = 0;
let lockoutUntil = null;

function selectRole(el, role) {
  document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
  selectedRole = role;
}

function togglePwd() {
  const inp = document.getElementById('loginPass');
  const eye = document.getElementById('pwdEye');
  if (inp.type === 'password') { inp.type = 'text'; eye.textContent = 'üôà'; }
  else { inp.type = 'password'; eye.textContent = 'üëÅ'; }
}

function attemptLogin() {
  const now = Date.now();
  if (lockoutUntil && now < lockoutUntil) {
    const secs = Math.ceil((lockoutUntil - now)/1000);
    showLoginError(`Too many attempts. Try again in ${secs}s`);
    return;
  }

  const username = document.getElementById('loginUser').value.trim().toLowerCase();
  const password = document.getElementById('loginPass').value;
  const btn = document.getElementById('loginBtn');

  if (!username || !password) {
    showLoginError('Please enter username and password');
    return;
  }

  btn.disabled = true;
  btn.textContent = 'Authenticating...';

  setTimeout(() => {
    const user = USERS[username];
    if (user && user.pass === password) {
      // Success
      loginAttempts = 0;
      currentUser = { username, role: user.role, access: user.access };
      document.getElementById('roleBadge').textContent = user.role;
      sessionStart = Date.now();
      startSessionTimer();
      document.getElementById('loginError').textContent = '';
      btn.textContent = '‚úì Access Granted';
      btn.style.background = 'linear-gradient(135deg,#22c55e,#15803d)';
      setTimeout(() => {
        const screen = document.getElementById('loginScreen');
        screen.classList.add('login-screen-exit');
        setTimeout(() => { screen.style.display = 'none'; }, 400);
        showToast(`Welcome, ${user.role} ‚Äî ${username}. Session started.`);
        applyRoleRestrictions(user.access);
      }, 700);
    } else {
      loginAttempts++;
      if (loginAttempts >= 5) {
        lockoutUntil = Date.now() + 60000;
        showLoginError('Account locked for 60s after 5 failed attempts');
      } else {
        showLoginError(`Invalid credentials (${5 - loginAttempts} attempts remaining)`);
      }
      btn.disabled = false;
      btn.textContent = 'Access Dashboard ‚Üí';
      btn.style.background = '';
      // Shake the box
      const box = document.querySelector('.login-box');
      box.style.animation = 'none';
      setTimeout(() => box.style.animation = '', 10);
    }
  }, 800);
}

function showLoginError(msg) {
  const el = document.getElementById('loginError');
  el.textContent = msg;
  el.style.animation = 'none';
  setTimeout(() => el.style.animation = 'errShake 0.3s ease', 10);
}

function applyRoleRestrictions(access) {
  // Viewers can't see financial raw data
  if (access === 'view') {
    document.querySelectorAll('.tab-btn').forEach(b => {
      if (b.textContent.includes('Financial')) {
        b.style.opacity = '0.4';
        b.style.pointerEvents = 'none';
        b.title = 'Finance access required';
      }
    });
  }
  // Operations: hide financial tab
  if (access === 'ops') {
    document.querySelectorAll('.tab-btn').forEach(b => {
      if (b.textContent.includes('Financial')) {
        b.style.opacity = '0.4';
        b.style.pointerEvents = 'none';
      }
    });
  }
}

function startSessionTimer() {
  sessionTimerInterval = setInterval(() => {
    if (!sessionStart) return;
    const elapsed = Math.floor((Date.now() - sessionStart) / 1000);
    const m = Math.floor(elapsed / 60).toString().padStart(2,'0');
    const s = (elapsed % 60).toString().padStart(2,'0');
    const el = document.getElementById('sessionTimer');
    if (el) el.textContent = `Session: ${m}:${s}`;
    // Auto-logout after 4 hours
    if (elapsed > 14400) logOut();
  }, 1000);
}

function logOut() {
  if (sessionTimerInterval) clearInterval(sessionTimerInterval);
  currentUser = null; sessionStart = null;
  // Reset header
  document.getElementById('roleBadge').textContent = '‚Äî';
  document.getElementById('sessionTimer').textContent = '';
  document.getElementById('wsLabel').textContent = 'Simulated Feed';
  document.getElementById('wsDot').className = 'ws-dot simulated';
  // Restore tab access
  document.querySelectorAll('.tab-btn').forEach(b => {
    b.style.opacity = '';
    b.style.pointerEvents = '';
  });
  // Reset login form
  document.getElementById('loginUser').value = '';
  document.getElementById('loginPass').value = '';
  document.getElementById('loginPass').type = 'password';
  document.getElementById('pwdEye').textContent = 'üëÅ';
  document.getElementById('loginError').textContent = '';
  const btn = document.getElementById('loginBtn');
  btn.textContent = 'Access Dashboard ‚Üí';
  btn.disabled = false;
  btn.style.background = '';
  // Show login screen
  const screen = document.getElementById('loginScreen');
  screen.classList.remove('login-screen-exit');
  screen.style.display = 'flex';
  screen.style.animation = 'none';
  showToast('Logged out successfully');
}

// Block dashboard interaction if not logged in
document.addEventListener('DOMContentLoaded', () => {
  // Intercept tab clicks if not logged in
  document.querySelectorAll('.tab-btn').forEach(btn => {
    const originalOnclick = btn.getAttribute('onclick');
    btn.setAttribute('onclick', `if(!currentUser){showLoginError('Please log in first');return;} ${originalOnclick}`);
  });
});


// ‚ïê‚ïê ADMIN PANEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const admLog = [];
function adminLog(msg) {
  const ts = new Date().toLocaleTimeString();
  admLog.unshift(`[${ts}] ${msg}`);
  if (admLog.length > 50) admLog.pop();
  const el = document.getElementById('activityLog');
  if (el) el.innerHTML = admLog.map(l=>`<div style="padding:2px 0;border-bottom:1px solid rgba(255,255,255,0.03);">${l}</div>`).join('');
}

function openAdminTab() {
  if (!currentUser) { showToast('‚ö† Please log in first'); return; }
  if (currentUser.access !== 'all') { showToast('‚ö† Admin access requires Executive role'); return; }
  document.getElementById('adminOverlay').style.display = 'block';
  document.body.style.overflow = 'hidden';
  renderUserRows();
  renderTabToggles();
  renderActiveSessions();
  adminLog('Admin panel opened by ' + currentUser.username);
}

function closeAdmin() {
  document.getElementById('adminOverlay').style.display = 'none';
  document.body.style.overflow = '';
}

function switchAdminTab(name) {
  document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('asec-' + name).classList.add('active');
}

function showAdminSuccess(id) {
  const el = document.getElementById(id);
  if (!el) return;
  el.style.display = 'block';
  setTimeout(() => el.style.display = 'none', 2500);
}

// ‚îÄ‚îÄ DATA SOURCES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function admConnectGS() {
  const url = document.getElementById('adm-gsUrl').value.trim();
  const interval = document.getElementById('adm-gsInterval').value;
  if (!url) { showToast('‚ö† Please paste a Google Sheets URL'); return; }
  // Sync with main connector
  document.getElementById('gsUrl').value = url;
  document.getElementById('gsInterval').value = interval;
  document.getElementById('gs-admin-status').textContent = 'Connecting...';
  document.getElementById('gs-admin-status').className = 'conn-status testing';
  connectGoogleSheets().then ? connectGoogleSheets() : connectGoogleSheets();
  setTimeout(() => {
    const s = document.getElementById('gsStatus').textContent;
    if (s.includes('Synced') || s.includes('rows')) {
      document.getElementById('gs-admin-status').textContent = 'Connected ‚úì';
      document.getElementById('gs-admin-status').className = 'conn-status connected';
      showAdminSuccess('gs-admin-msg');
      admSaveToStorage();
    } else {
      document.getElementById('gs-admin-status').textContent = 'Failed';
      document.getElementById('gs-admin-status').className = 'conn-status disconnected';
    }
  }, 3500);
  adminLog('Google Sheets connect attempted: ' + url.slice(0,50) + '...');
}

function admDisconnectGS() {
  disconnectGoogleSheets();
  document.getElementById('gs-admin-status').textContent = 'Disconnected';
  document.getElementById('gs-admin-status').className = 'conn-status disconnected';
  adminLog('Google Sheets disconnected');
}

function admConnectAPI() {
  const url = document.getElementById('adm-apiUrl').value.trim();
  const key = document.getElementById('adm-apiKey').value.trim();
  const interval = document.getElementById('adm-apiInterval').value;
  const endpoint = document.getElementById('adm-apiEndpoint').value.trim() || '/pilot/metrics';
  if (!url || !key) { showToast('‚ö† API URL and Key are required'); return; }
  document.getElementById('adm-apiUrl').value = url;
  document.getElementById('apiUrl') && (document.getElementById('apiUrl').value = url);
  document.getElementById('apiKey') && (document.getElementById('apiKey').value = key);
  document.getElementById('pollInterval') && (document.getElementById('pollInterval').value = interval);
  document.getElementById('api-admin-status').textContent = 'Connecting...';
  document.getElementById('api-admin-status').className = 'conn-status testing';
  connectAPI();
  setTimeout(() => {
    document.getElementById('api-admin-status').textContent = 'Connected ‚úì';
    document.getElementById('api-admin-status').className = 'conn-status connected';
    showAdminSuccess('api-admin-msg');
    admSaveToStorage();
  }, 1500);
  adminLog('Foodelo API connect: ' + url);
}

function admDisconnectAPI() {
  if (state.apiInterval) clearInterval(state.apiInterval);
  document.getElementById('api-admin-status').textContent = 'Disconnected';
  document.getElementById('api-admin-status').className = 'conn-status disconnected';
  adminLog('Foodelo API disconnected');
}

function admTestAPI() {
  const url = document.getElementById('adm-apiUrl').value.trim();
  const key = document.getElementById('adm-apiKey').value.trim();
  const el = document.getElementById('api-admin-test');
  el.textContent = '‚è≥ Pinging...';
  el.style.color = 'var(--yellow)';
  document.getElementById('api-admin-status').className = 'conn-status testing';
  setTimeout(() => {
    if (url && key) {
      el.textContent = '‚ö† Simulation mode ‚Äî enter real Foodelo API URL & key to get live data';
      el.style.color = 'var(--yellow)';
    } else {
      el.textContent = '‚ö† Please fill in API URL and Key first';
      el.style.color = 'var(--red)';
    }
  }, 1000);
  adminLog('API connection test run');
}

function admConnectSP() {
  const url = document.getElementById('adm-spUrl').value.trim();
  if (!url) { showToast('‚ö† Please enter SharePoint URL'); return; }
  document.getElementById('sp-admin-status').textContent = 'Configured ‚úì';
  document.getElementById('sp-admin-status').className = 'conn-status connected';
  admSaveToStorage();
  showToast('SharePoint URL saved. Note: CORS proxy may be needed for cross-domain access.');
  adminLog('SharePoint configured: ' + url.slice(0,50));
}

function admDisconnectSP() {
  document.getElementById('sp-admin-status').textContent = 'Disconnected';
  document.getElementById('sp-admin-status').className = 'conn-status disconnected';
  adminLog('SharePoint disconnected');
}

function admConnectWS() {
  const url = document.getElementById('adm-wsUrl').value.trim();
  if (!url) { showToast('‚ö† Please enter WebSocket URL (wss://)'); return; }
  document.getElementById('ws-admin-status').textContent = 'Connecting...';
  document.getElementById('ws-admin-status').className = 'conn-status testing';
  // Attempt real WSS connection
  try {
    if (state.ws) state.ws.close();
    state.ws = new WebSocket(url);
    state.ws.onopen = () => {
      document.getElementById('ws-admin-status').textContent = 'Connected ‚úì';
      document.getElementById('ws-admin-status').className = 'conn-status connected';
      document.getElementById('wsDot').className = 'ws-dot connected';
      document.getElementById('wsLabel').textContent = 'WSS Live';
      showToast('‚úì WebSocket connected: ' + url);
      adminLog('WebSocket connected: ' + url);
    };
    state.ws.onmessage = (e) => {
      try { const d = JSON.parse(e.data); ingestData(d); } catch(ex) {}
    };
    state.ws.onerror = () => {
      document.getElementById('ws-admin-status').textContent = 'Error';
      document.getElementById('ws-admin-status').className = 'conn-status disconnected';
      showToast('‚ö† WebSocket connection failed ‚Äî check URL');
    };
    state.ws.onclose = () => {
      document.getElementById('ws-admin-status').textContent = 'Closed';
      document.getElementById('ws-admin-status').className = 'conn-status disconnected';
    };
  } catch(e) {
    showToast('‚ö† Invalid WebSocket URL');
  }
}

function admDisconnectWS() {
  if (state.ws) { state.ws.close(); state.ws = null; }
  document.getElementById('ws-admin-status').textContent = 'Disconnected';
  document.getElementById('ws-admin-status').className = 'conn-status disconnected';
  document.getElementById('wsDot').className = 'ws-dot simulated';
  document.getElementById('wsLabel').textContent = 'Simulated Feed';
  adminLog('WebSocket disconnected');
}

function admHandleFile(e) {
  const file = e.target.files[0];
  if (!file) return;
  handleFileUpload(e);
  document.getElementById('adm-file-status').innerHTML =
    `<span style="color:var(--green)">‚úì ${file.name} uploaded (${(file.size/1024).toFixed(1)} KB)</span>`;
  adminLog('File uploaded: ' + file.name);
}

function admSaveDataSources() {
  admSaveToStorage();
  showAdminSuccess('gs-admin-msg');
  showToast('‚úì Data source settings saved');
  adminLog('Data source settings saved');
}

// ‚îÄ‚îÄ USERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderUserRows() {
  const container = document.getElementById('userRows');
  container.innerHTML = Object.entries(USERS).map(([uname, data]) => `
    <div class="user-row" id="urow-${uname}">
      <div>
        <label class="admin-label">Username</label>
        <input class="admin-input" value="${uname}" id="uname-${uname}" placeholder="username" style="margin-bottom:0;">
      </div>
      <div>
        <label class="admin-label">Password</label>
        <input class="admin-input" value="${data.pass}" id="upass-${uname}" type="text" placeholder="password" style="margin-bottom:0;">
      </div>
      <div>
        <label class="admin-label">Role</label>
        <select class="admin-input" id="urole-${uname}" style="margin-bottom:0;">
          <option value="Executive" ${data.role==='Executive'?'selected':''}>üëî Executive</option>
          <option value="Operations" ${data.role==='Operations'?'selected':''}>‚öôÔ∏è Operations</option>
          <option value="Finance" ${data.role==='Finance'?'selected':''}>üí∞ Finance</option>
          <option value="Viewer" ${data.role==='Viewer'?'selected':''}>üëÅÔ∏è Viewer</option>
        </select>
      </div>
      <div style="display:flex;align-items:flex-end;padding-bottom:2px;">
        <button class="admin-danger-btn" onclick="admDeleteUser('${uname}')" ${uname==='admin'?'disabled title="Cannot delete admin"':''}>‚úï</button>
      </div>
    </div>
  `).join('') + `<div style="border-top:1px solid var(--border);margin-top:8px;padding-top:12px;">
    <button class="admin-save-btn" onclick="admSaveUsers()">üíæ Save All Users</button>
    <div class="admin-success" id="users-msg" style="display:inline-block;margin-left:10px;">‚úì Users saved</div>
  </div>`;
}

function admSaveUsers() {
  Object.keys(USERS).forEach(uname => {
    const newName = document.getElementById('uname-'+uname)?.value.trim();
    const newPass = document.getElementById('upass-'+uname)?.value.trim();
    const newRole = document.getElementById('urole-'+uname)?.value;
    if (newPass) USERS[uname].pass = newPass;
    if (newRole) {
      USERS[uname].role = newRole;
      const accessMap = {Executive:'all',Operations:'ops',Finance:'fin',Viewer:'view'};
      USERS[uname].access = accessMap[newRole];
    }
  });
  // Update credentials display on login screen
  showAdminSuccess('users-msg');
  admSaveToStorage();
  showToast('‚úì User credentials updated');
  adminLog('Users updated by ' + currentUser.username);
}

function admAddUser() {
  const id = 'user_' + Date.now();
  USERS[id] = { pass:'NewPass@1', role:'Viewer', access:'view' };
  renderUserRows();
  adminLog('New user added');
}

function admDeleteUser(uname) {
  if (uname === 'admin') return;
  delete USERS[uname];
  renderUserRows();
  adminLog('User deleted: ' + uname);
}

function renderActiveSessions() {
  const el = document.getElementById('activeSessions');
  if (!el) return;
  if (currentUser) {
    const elapsed = Math.floor((Date.now() - sessionStart)/1000);
    const m = Math.floor(elapsed/60); const s = elapsed%60;
    el.innerHTML = `<div style="padding:8px;background:rgba(34,197,94,0.05);border:1px solid rgba(34,197,94,0.1);border-radius:6px;">
      <span style="color:var(--green)">‚óè Active</span>
      &nbsp;¬∑&nbsp; <b>${currentUser.username}</b>
      &nbsp;¬∑&nbsp; ${currentUser.role}
      &nbsp;¬∑&nbsp; Session: ${m}m ${s}s
      &nbsp;&nbsp;
      <button class="admin-danger-btn" onclick="logOut();closeAdmin();">Force Logout</button>
    </div>`;
  } else {
    el.textContent = 'No active sessions';
  }
}

// ‚îÄ‚îÄ PILOT SETTINGS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function admSavePilot() {
  const phase = document.getElementById('adm-phase').value;
  const m1 = document.getElementById('adm-m1prog').value;
  const m2 = document.getElementById('adm-m2prog').value;
  const phases = document.querySelectorAll('.track-phase');
  const labels = ['MONTH 1 ‚Äî BASELINE','MONTH 2 ‚Äî OPTIMIZATION','MONTH 3 ‚Äî VALIDATION'];
  document.getElementById('currentPhaseBadge').textContent = labels[phase-1];
  if (phases.length >= 3) {
    phases[0].querySelector('.track-phase-fill').style.width = m1 + '%';
    phases[0].querySelector('div:last-child').textContent = m1 + '% complete';
    phases[1].querySelector('.track-phase-fill').style.width = m2 + '%';
    phases[1].querySelector('div:last-child').textContent = m2 > 0 ? m2 + '% complete' : 'Not started';
  }
  showAdminSuccess('pilot-msg');
  admSaveToStorage();
  showToast('‚úì Pilot phase updated to Month ' + phase);
  adminLog('Pilot phase set to Month ' + phase);
}

function admSaveOrg() {
  const org = document.getElementById('adm-orgName').value;
  const title = document.getElementById('adm-dashTitle').value;
  const currency = document.getElementById('adm-currency').value;
  // Update logo text
  const logoText = document.querySelector('.logo-text');
  if (logoText && title) logoText.innerHTML = title.split(' ').slice(0,-1).join(' ') + ' <span>' + (title.split(' ').pop()) + '</span>';
  document.title = title + ' ‚Äî Executive Dashboard';
  showAdminSuccess('org-msg');
  admSaveToStorage();
  adminLog('Org settings updated: ' + org + ' / ' + title);
}

// ‚îÄ‚îÄ KPI TARGETS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const defaultTargets = {
  orders:180, revenue:6000000, csat:4.7, nps:75,
  uptime:99.9, delivery:15, payment:99, refund:1.0, rider:92, merchant:96
};

function admSaveTargets() {
  const targets = {
    orders: +document.getElementById('tgt-orders').value,
    revenue: +document.getElementById('tgt-revenue').value,
    csat: +document.getElementById('tgt-csat').value,
    nps: +document.getElementById('tgt-nps').value,
    uptime: +document.getElementById('tgt-uptime').value,
    delivery: +document.getElementById('tgt-delivery').value,
    payment: +document.getElementById('tgt-payment').value,
    refund: +document.getElementById('tgt-refund').value,
    rider: +document.getElementById('tgt-rider').value,
    merchant: +document.getElementById('tgt-merchant').value,
  };
  state.targets = targets;
  showAdminSuccess('tgt-msg');
  admSaveToStorage();
  adminLog('KPI targets updated');
}

function admResetTargets() {
  Object.entries(defaultTargets).forEach(([k,v]) => {
    const el = document.getElementById('tgt-'+k);
    if (el) el.value = v;
  });
  admSaveTargets();
}

function admSaveAlerts() {
  showAdminSuccess('alert-msg');
  admSaveToStorage();
  adminLog('Alert thresholds saved');
}

// ‚îÄ‚îÄ DISPLAY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setAccent(color) {
  document.documentElement.style.setProperty('--accent', color);
  document.querySelectorAll('[style*="background: linear-gradient(135deg, var(--accent)"]').forEach(el => {
    el.style.background = `linear-gradient(135deg, ${color}, #dc2626)`;
  });
  showToast('‚úì Accent color changed to ' + color);
  adminLog('Accent color changed: ' + color);
}

function toggleTicker(cb) {
  const ticker = document.querySelector('.alert-ticker');
  if (ticker) ticker.style.display = cb.checked ? 'flex' : 'none';
  adminLog('Ticker ' + (cb.checked ? 'shown' : 'hidden'));
}

function toggleGrid(cb) {
  document.body.style.setProperty('--grid-opacity', cb.checked ? '1' : '0');
  const before = document.querySelector('body::before');
  document.body.classList.toggle('no-grid', !cb.checked);
  adminLog('Background grid ' + (cb.checked ? 'shown' : 'hidden'));
}

function toggleCompact(cb) {
  document.querySelectorAll('.kpi-card').forEach(c => {
    c.style.padding = cb.checked ? '8px 10px' : '';
  });
  document.querySelectorAll('.kpi-value').forEach(v => {
    v.style.fontSize = cb.checked ? '16px' : '';
  });
  adminLog('Compact mode ' + (cb.checked ? 'on' : 'off'));
}

let tvModeInterval = null;
const tvTabs = ['overview','financial','customers','merchants','tech','riders','scalability'];
let tvIndex = 0;
function toggleTVMode(cb) {
  if (cb.checked) {
    tvModeInterval = setInterval(() => {
      tvIndex = (tvIndex + 1) % tvTabs.length;
      const btns = document.querySelectorAll('.tab-btn');
      btns.forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
      document.getElementById('tab-'+tvTabs[tvIndex]).classList.add('active');
      initChartsForTab(tvTabs[tvIndex]);
    }, 30000);
    showToast('üì∫ TV Mode ON ‚Äî tabs rotate every 30 seconds');
  } else {
    if (tvModeInterval) clearInterval(tvModeInterval);
    showToast('TV Mode OFF');
  }
  adminLog('TV mode ' + (cb.checked ? 'enabled' : 'disabled'));
}

function renderTabToggles() {
  const el = document.getElementById('tabToggles');
  if (!el) return;
  const tabs = [
    ['overview','üìä Overview'],['financial','üí∞ Financial'],['customers','üë• Customers'],
    ['merchants','üè™ Merchants'],['tech','‚öôÔ∏è Technology'],['riders','üõµ Riders'],
    ['scalability','üìà Scalability'],['connect','üîó Connect Data']
  ];
  el.innerHTML = tabs.map(([id, label]) => `
    <div class="admin-toggle">
      <div><div class="toggle-label">${label}</div></div>
      <label class="toggle-switch">
        <input type="checkbox" checked onchange="toggleTabVisibility('${id}', this.checked)">
        <span class="toggle-slider"></span>
      </label>
    </div>
  `).join('');
}

function toggleTabVisibility(tabId, show) {
  document.querySelectorAll('.tab-btn').forEach(btn => {
    if (btn.getAttribute('onclick') && btn.getAttribute('onclick').includes("'"+tabId+"'")) {
      btn.style.display = show ? '' : 'none';
    }
  });
  adminLog('Tab ' + tabId + ' ' + (show ? 'shown' : 'hidden'));
}

function admSaveDisplay() {
  showAdminSuccess('disp-msg');
  admSaveToStorage();
  adminLog('Display settings saved');
}

// ‚îÄ‚îÄ NOTIFICATIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleNotifs(cb) {
  if (cb.checked) {
    Notification.requestPermission().then(p => {
      if (p === 'granted') showToast('‚úì Browser notifications enabled');
      else { cb.checked = false; showToast('‚ö† Browser notifications denied by browser'); }
    });
  }
}

function admSaveNotifications() {
  showAdminSuccess('notif-msg');
  admSaveToStorage();
  adminLog('Notification settings saved');
}

function admTestWebhook() {
  const url = document.getElementById('adm-webhook').value;
  if (!url) { showToast('‚ö† Please enter a webhook URL'); return; }
  showToast('üß™ Test webhook sent to: ' + url.slice(0,40) + '...');
  adminLog('Webhook test sent: ' + url);
}

// ‚îÄ‚îÄ SAVE SETTINGS TO LOCALSTORAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function admSaveToStorage() {
  try {
    const settings = {
      gsUrl: document.getElementById('adm-gsUrl')?.value || '',
      gsInterval: document.getElementById('adm-gsInterval')?.value || '60',
      apiUrl: document.getElementById('adm-apiUrl')?.value || '',
      apiInterval: document.getElementById('adm-apiInterval')?.value || '30',
      spUrl: document.getElementById('adm-spUrl')?.value || '',
      phase: document.getElementById('adm-phase')?.value || '1',
      m1prog: document.getElementById('adm-m1prog')?.value || '68',
      orgName: document.getElementById('adm-orgName')?.value || 'InfraCredit DREEF',
      dashTitle: document.getElementById('adm-dashTitle')?.value || 'Foodelo Pilot',
      targets: state.targets || defaultTargets,
    };
    localStorage.setItem('foodelo_admin_settings', JSON.stringify(settings));
  } catch(e) {}
}

function admLoadFromStorage() {
  try {
    const raw = localStorage.getItem('foodelo_admin_settings');
    if (!raw) return;
    const s = JSON.parse(raw);
    if (s.gsUrl) document.getElementById('adm-gsUrl').value = s.gsUrl;
    if (s.gsInterval) document.getElementById('adm-gsInterval').value = s.gsInterval;
    if (s.apiUrl) document.getElementById('adm-apiUrl').value = s.apiUrl;
    if (s.apiInterval) document.getElementById('adm-apiInterval').value = s.apiInterval;
    if (s.spUrl) document.getElementById('adm-spUrl').value = s.spUrl;
    if (s.phase) document.getElementById('adm-phase').value = s.phase;
    if (s.m1prog) document.getElementById('adm-m1prog').value = s.m1prog;
    if (s.orgName) document.getElementById('adm-orgName').value = s.orgName;
    if (s.dashTitle) document.getElementById('adm-dashTitle').value = s.dashTitle;
    if (s.targets) {
      state.targets = s.targets;
      Object.entries(s.targets).forEach(([k,v]) => {
        const el = document.getElementById('tgt-'+k);
        if(el) el.value = v;
      });
    }
    adminLog('Settings restored from storage');
  } catch(e) {}
}

// ‚îÄ‚îÄ SECURITY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function admSaveSecurity() {
  showAdminSuccess('sec-msg');
  admSaveToStorage();
  adminLog('Security settings saved');
}

// Close admin on Escape key
document.addEventListener('keydown', e => {
  if (e.key === 'Escape' && document.getElementById('adminOverlay').style.display === 'block') {
    closeAdmin();
  }
});

// Close on backdrop click
document.getElementById('adminOverlay').addEventListener('click', function(e) {
  if (e.target === this) closeAdmin();
});

// ‚îÄ‚îÄ‚îÄ BOOTSTRAP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded', ()=>{
  initOverviewCharts();
  admLoadFromStorage();
  // Start live simulation
  setInterval(()=>{
    // Rotate ticker
  }, 8000);
});

</script>

<style>
@keyframes slideIn {
  from { transform: translateY(20px); opacity:0; }
  to { transform: translateY(0); opacity:1; }
}
.kpi-card.yellow { border: 1px solid rgba(234,179,8,0.15); }
.kpi-card.yellow::before { background: linear-gradient(90deg, var(--yellow), transparent); }
</style>
</body>
</html>
